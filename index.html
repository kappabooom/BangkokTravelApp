<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8" />
    <meta
        name="viewport"
        content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no"
    />
    <title>2026曼谷旅行</title>

    <!-- Apple Touch Icon -->
    <meta name="apple-mobile-web-app-capable" content="yes" />
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent" />
    <link rel="apple-touch-icon" href="apple-touch-icon.png" />
    <link rel="icon" type="image/png" href="favicon-32x32.png" sizes="32x32" />
    <link rel="icon" type="image/png" href="favicon-16x16.png" sizes="16x16" />
    <link rel="manifest" href="site.webmanifest" />
    <link rel="mask-icon" href="safari-pinned-tab.svg" color="#5bbad5" />
    <meta name="msapplication-TileColor" content="#da532c" />
    <meta name="theme-color" content="#ffffff" />
    <meta name="apple-mobile-web-app-title" content="2026 BKK" />
    <meta name="application-name" content="2026 BKK" />

    <link
        rel="stylesheet"
        href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css"
        integrity="sha512-SnH5WK+bZxgPHs44uWIX+LLJAJ9/2PkPKZ5QiAj6Ta86w+fsb2TkcmfRyVX3pBnMFcV7oQPJkl9QevSCWr3W6A=="
        crossorigin="anonymous"
        referrerpolicy="no-referrer"
    />
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/vue@3/dist/vue.global.prod.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.6.1/firebase-firestore.js"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        "snow-white": "#FFFDE7",
                        "ice-blue": "#4DB6AC",
                        "light-snow-blue": "#FFF3E0",
                        "deep-sea-blue": "#E65100",
                        "accent-yellow": "#FFB300",
                        "soft-gray": "#FAFAFA",
                    },
                },
            },
        };
    </script>

    <style>
        @import url("https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@400;500;700;900&display=swap");
        body {
            font-family: "Noto Sans TC", sans-serif;
            background-color: #f8f9fa;
        }

        /* 隱藏滾動條但保留滾動功能 */
        .no-scrollbar::-webkit-scrollbar {
            display: none;
        }
        .no-scrollbar {
            -ms-overflow-style: none; /* IE and Edge */
            scrollbar-width: none; /* Firefox */
        }
        
        .tab-indicator {
            position: absolute;
            bottom: 0;
            left: 0;
            height: 3px;
            background-color: #e65100;
            border-radius: 3px 3px 0 0;
            transition: transform 0.3s cubic-bezier(0.68, -0.55, 0.27, 1.55),
                width 0.3s ease;
        }
        .tab.active {
            color: #e65100;
        }

        /* 解決 iOS 上的 100vh 問題 */
        html,
        body {
            height: 100%;
            overflow: hidden;
        }
        #app {
            height: 100%;
            display: flex;
            flex-direction: column;
        }
        .main-content {
            flex-grow: 1;
            overflow-y: auto;
        }
        .footer-nav {
            flex-shrink: 0;
            z-index: 50;
        }
        
        .main-container {
            display: grid;
            grid-template-rows: auto 1fr auto;
            height: 100%;
            overflow: hidden;
        }

        .group:hover .group-hover-visible {
            opacity: 1;
        }

        .itinerary-item {
            transition: transform 0.2s ease, opacity 0.2s ease, box-shadow 0.2s ease;
        }
        .animate-fade-in {
            animation: fadeIn 0.4s ease-out;
        }
        @keyframes fadeIn {
            from {
                opacity: 0;
                transform: translateY(10px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
        .animate-slide-up {
            animation: slideUp 0.3s ease-out;
        }
        @keyframes slideUp {
            from {
                opacity: 0;
                transform: translateY(100%);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
        
        .moved-item {
            animation: pulse-bg 1.5s ease-out;
        }
        @keyframes pulse-bg {
            0% { background-color: transparent; }
            30% { background-color: #fff8e1; }
            100% { background-color: transparent; }
        }
        
        /* Login Screen */
        .login-screen {
            position: fixed;
            inset: 0;
            z-index: 60;
            background: linear-gradient(135deg, #fff3e0 0%, #ffe0b2 100%);
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            isolation: isolate; 
        }
        
        .toast {
            position: fixed;
            top: 2rem;
            left: 50%;
            transform: translateX(-50%);
            z-index: 10001; 
            animation: toast-in 0.3s ease-out forwards;
        }
        @keyframes toast-in {
            from { opacity: 0; transform: translate(-50%, -20px); }
            to { opacity: 1; transform: translate(-50%, 0); }
        }
    </style>
</head>

<body class="bg-slate-50 overflow-hidden">
    <div id="app" class="h-full w-full max-w-lg mx-auto bg-white shadow-xl main-container">
        <!-- Toast Notification -->
        <div v-if="showToast" class="toast bg-slate-800 text-white text-sm font-bold py-3 px-6 rounded-full shadow-lg animate-fade-in">
            {{ toastMessage }}
        </div>

        <!-- Login Screen -->
        <div v-if="!hasSelectedUser" class="login-screen animate-fade-in p-6">
            <div class="text-center mb-8">
                <div class="w-24 h-24 bg-white rounded-full mx-auto shadow-lg flex items-center justify-center mb-4">
                    <i class="fa-solid fa-plane-up text-4xl text-deep-sea-blue"></i>
                </div>
                <h1 class="text-2xl font-black text-slate-700">2026 曼谷之旅</h1>
                <p class="text-sm text-slate-500 mt-1">請選擇您的身份以繼續</p>
            </div>

            <div v-if="members.length === 0" class="flex flex-col items-center">
                <i class="fa-solid fa-spinner fa-spin text-2xl text-slate-400"></i>
                <span class="text-xs text-slate-400">正在讀取成員...</span>
            </div>
            <div v-else-if="loginStep === 'select'" class="grid grid-cols-2 gap-4 w-full max-w-sm animate-fade-in">
                <div
                    v-for="member in members"
                    :key="member.id"
                    @click="attemptLogin(member)"
                    class="bg-white p-4 rounded-2xl shadow-sm border border-orange-100 flex flex-col items-center justify-center cursor-pointer hover:shadow-md hover:scale-105 transition-all relative overflow-hidden group"
                >
                    <div class="absolute top-0 right-0 p-2" v-if="member.role === 'admin' || member.password">
                        <i class="fa-solid fa-lock text-xs text-orange-300"></i>
                    </div>
                    <div v-if="member.role === 'admin'" class="absolute top-1 left-1 bg-deep-sea-blue text-white text-[8px] font-bold px-2 py-0.5 rounded-full">
                        ADMIN
                    </div>
                    <div class="w-14 h-14 rounded-full bg-orange-50 mb-3 flex items-center justify-center">
                        <i :class="['fa-solid', member.role === 'admin' ? 'fa-user-secret' : 'fa-user', 'text-2xl', 'text-orange-400']"></i>
                    </div>
                    <span class="font-bold text-slate-700 text-sm">{{ member.name }}</span>
                </div>
            </div>
            <div v-else-if="loginStep === 'password'" class="w-full max-w-xs animate-fade-in">
                <div class="bg-white rounded-3xl p-6 shadow-xl border border-orange-100">
                    <div class="w-16 h-16 bg-orange-100 rounded-full flex items-center justify-center mx-auto mb-4 text-deep-sea-blue shadow-inner">
                         <i :class="['fa-solid', targetLoginMember?.role === 'admin' ? 'fa-user-secret' : 'fa-user', 'text-3xl']"></i>
                    </div>
                    
                    <h3 class="font-bold text-lg mb-2 text-center text-slate-800">
                        {{ passwordMode === "loginAdmin" ? "Admin 身份驗證" : `歡迎回來，${targetLoginMember?.name}` }}
                    </h3>
                    <p class="text-xs text-center text-slate-400 mb-6">請輸入密碼以繼續</p>
                    
                    <input
                        ref="rolePasswordInputRef"
                        v-model="rolePasswordInput"
                        type="password"
                        placeholder="請輸入密碼"
                        class="w-full bg-slate-50 rounded-xl p-4 text-center font-bold text-deep-sea-blue text-lg outline-none border-2 border-transparent focus:border-deep-sea-blue focus:bg-white transition-all mb-4 tracking-widest ring-1 ring-slate-100 focus:ring-deep-sea-blue/30"
                        @keyup.enter="confirmRolePassword"
                    />
                    
                    <div class="flex space-x-3 mt-4">
                        <button @click="cancelRolePassword" class="flex-1 py-3 rounded-xl bg-slate-100 text-slate-500 text-sm font-bold hover:bg-slate-200 transition-colors">
                            <i class="fa-solid fa-arrow-left mr-1"></i> 返回
                        </button>
                        <button @click="confirmRolePassword" class="flex-1 py-3 rounded-xl bg-gradient-to-r from-deep-sea-blue to-orange-500 text-white text-sm font-bold hover:opacity-90 transition-opacity shadow-lg shadow-orange-200">
                            登入 <i class="fa-solid fa-arrow-right ml-1"></i>
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <!-- Main Content -->
        <template v-if="hasSelectedUser">
            <header class="p-4 bg-white border-b border-gray-100 flex justify-between items-center flex-shrink-0 relative z-50">
                <div>
                    <h1 class="font-black text-xl text-slate-800">2026 曼谷之旅</h1>
                    <div class="text-xs text-slate-400">{{ dates[0].date }} - {{ dates[dates.length - 1].date }}</div>
                </div>
                <div class="text-right">
                    <div class="font-bold text-slate-600 text-sm">{{ currentUser }}</div>
                    <div v-if="currentUserRole === 'admin'" class="text-xs font-bold bg-deep-sea-blue text-white px-2 py-0.5 rounded-full inline-block mt-1">ADMIN</div>
                </div>
            </header>

            <main class="main-content bg-slate-50 no-scrollbar">
                <!-- Itinerary View -->
                <div v-show="currentTab === 'itinerary'">
                    <!-- Date Tabs (Sticky & Solid Background) -->
                    <div class="sticky top-0 bg-[#f8f9fa] z-[40] flex justify-between items-center px-2 py-2 border-b border-slate-200 no-scrollbar overflow-x-auto shadow-sm relative">
                        <div
                            v-for="(day, index) in dates"
                            :key="index"
                            @click="selectedDateIndex = index"
                            :class="{
                                'border-deep-sea-blue text-deep-sea-blue bg-white shadow-sm': selectedDateIndex === index,
                                'border-transparent text-slate-500': selectedDateIndex !== index,
                            }"
                            class="text-center px-3 py-1 rounded-full cursor-pointer transition-all border-2 flex-shrink-0 mx-1"
                        >
                            <div class="text-xs">{{ day.weekday }}</div>
                            <div class="font-bold text-sm">{{ day.date }}</div>
                        </div>
                    </div>

                    <!-- Weather Info -->
                    <div v-if="weatherData[selectedDateIndex]" class="p-4 bg-white shadow-sm flex items-center space-x-4 relative z-30">
                        <div class="text-4xl">
                           <i :class="getWeatherIcon(weatherData[selectedDateIndex].condition)"></i>
                        </div>
                        <div class="flex-grow">
                            <div class="font-bold text-xl text-slate-800">
                                {{ weatherData[selectedDateIndex].temp.split('/')[0] }}° / {{ weatherData[selectedDateIndex].temp.split("/")[1] }}°C
                                <span class="text-sm font-normal text-slate-500 ml-2">體感: {{ weatherData[selectedDateIndex].feel }}°C</span>
                            </div>
                            <div class="text-sm text-slate-500">
                                {{ getWeatherDescription(weatherData[selectedDateIndex].condition) }}
                            </div>
                        </div>
                        <div class="text-right text-xs text-slate-400">
                            <div>1月歷史平均</div>
                            <div v-if="weatherData[selectedDateIndex].is_realtime" class="text-green-500 font-bold">(距出發大於5天) 即時天氣預報</div>
                            <div v-else class="text-blue-500 font-bold">(出發前5天更新)</div>
                        </div>
                    </div>
                    
                    <div v-if="dates[selectedDateIndex].hasCar" class="px-4 py-2 bg-blue-50 text-blue-700 text-sm font-bold flex items-center justify-center space-x-2 relative z-30">
                        <i class="fa-solid fa-car"></i>
                        <span>租車日</span>
                    </div>

                    <!-- Itinerary List -->
                    <div class="p-4 space-y-3 relative z-10">
                        <transition-group name="list" tag="div" class="space-y-3">
                            <div v-for="(item, index) in currentItinerary" :key="item.id"
                                class="itinerary-item bg-white p-4 rounded-xl shadow-sm border border-gray-100 flex items-start space-x-4 relative"
                                :class="{ 'moved-item': item.id === recentlyMovedId }">

                                <div class="w-10 h-10 rounded-full flex items-center justify-center text-white flex-shrink-0" :class="getCategoryColor(item.category)">
                                    <i :class="getCategoryIcon(item.category)"></i>
                                </div>

                                <div class="flex-grow min-w-0">
                                    <div class="flex justify-between items-start">
                                        <div>
                                            <div v-if="item.time" class="text-xs text-slate-400 font-bold">{{ item.time }}</div>
                                            <h3 class="font-bold text-slate-800 break-words">{{ item.title }}</h3>
                                            <p v-if="item.description" class="text-sm text-slate-500 mt-1 break-words">{{ item.description }}</p>
                                        </div>
                                        <div v-if="item.transport" class="flex-shrink-0 ml-2 text-right">
                                            <div class="text-xs text-slate-400 flex flex-col items-end">
                                                <i :class="getTransportIcon(item.transport.method)"></i>
                                                <span>{{ item.transport.duration }}</span>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                
                                <div v-if="canEditItinerary" class="absolute top-2 right-2 flex space-x-1 opacity-0 group-hover:opacity-100 transition-opacity bg-white/80 backdrop-blur-sm rounded-lg p-1">
                                    <button @click="moveItem(item, 'up')" :disabled="index === 0" class="w-6 h-6 bg-slate-100 rounded-full flex items-center justify-center text-slate-500 hover:bg-slate-200 disabled:opacity-30"><i class="fa-solid fa-arrow-up text-xs"></i></button>
                                    <button @click="moveItem(item, 'down')" :disabled="index === currentItinerary.length - 1" class="w-6 h-6 bg-slate-100 rounded-full flex items-center justify-center text-slate-500 hover:bg-slate-200 disabled:opacity-30"><i class="fa-solid fa-arrow-down text-xs"></i></button>
                                    <button @click="editItem(item, 'itinerary')" class="w-6 h-6 bg-slate-100 rounded-full flex items-center justify-center text-slate-500 hover:bg-slate-200"><i class="fa-solid fa-pencil text-xs"></i></button>
                                </div>
                            </div>
                        </transition-group>

                        <div v-if="currentItinerary.length === 0" class="text-center py-10">
                            <i class="fa-solid fa-calendar-day text-4xl text-slate-300"></i>
                            <p class="mt-2 text-sm text-slate-400">本日無行程</p>
                        </div>
                    </div>
                </div>

                <!-- Shopping List View -->
                <div v-show="currentTab === 'shopping'">
                    <div class="p-4">
                        <h2 class="font-bold text-lg text-slate-800 mb-2">匯率換算</h2>
                        <div class="bg-white p-4 rounded-xl shadow-sm border border-gray-100 flex items-center space-x-4">
                            <div class="flex-1">
                                <label class="text-xs text-slate-500">泰銖 THB</label>
                                <input type="number" v-model="inputTHB" @input="updateTWD" class="w-full font-bold text-2xl bg-transparent outline-none">
                            </div>
                            <div class="text-2xl text-slate-300"><i class="fa-solid fa-right-left"></i></div>
                            <div class="flex-1 text-right">
                                <label class="text-xs text-slate-500">台幣 TWD</label>
                                <input type="number" v-model="inputTWD" @input="updateTHB" class="w-full font-bold text-2xl bg-transparent outline-none text-right">
                            </div>
                        </div>
                        <div class="text-right text-xs mt-2 text-slate-400">
                            1 THB = {{ EXCHANGE_RATE.toFixed(4) }} TWD
                             <button @click="fetchExchangeRate" :disabled="isRatesLoading" class="ml-2 text-blue-500 disabled:text-slate-300">
                                <i :class="isRatesLoading ? 'fa-solid fa-spinner fa-spin' : 'fa-solid fa-arrows-rotate'"></i> 更新
                            </button>
                        </div>
                    </div>
                    <div class="p-4">
                        <h2 class="font-bold text-lg text-slate-800 mb-2">{{ currentUser }} 的清單</h2>
                        <div class="bg-white rounded-xl shadow-sm border border-gray-100 divide-y divide-gray-100">
                           <div v-for="item in currentShoppingList" :key="item.id" class="p-4 flex items-center">
                               <input type="checkbox" :checked="item.checked" @change="toggleShoppingItem(item)" class="w-5 h-5 rounded-md border-gray-300 text-deep-sea-blue focus:ring-deep-sea-blue/50">
                               <span :class="{'line-through text-slate-400': item.checked}" class="ml-3 text-slate-700 flex-grow">{{ item.name }}</span>
                               <button @click="removeShoppingItem(item.id)" class="text-slate-300 hover:text-red-500 ml-4"><i class="fa-solid fa-trash-can"></i></button>
                           </div>
                           <div v-if="currentShoppingList.length === 0" class="p-6 text-center text-sm text-slate-400">
                               <i class="fa-solid fa-cart-shopping text-2xl mb-2"></i>
                               <p>目前沒有任何項目</p>
                           </div>
                        </div>
                        <div class="mt-3 flex space-x-2">
                            <input v-model="newShoppingItem.name" @keyup.enter="addShoppingItem" type="text" placeholder="新增項目..." class="flex-grow bg-white p-3 rounded-xl border border-gray-200 outline-none focus:border-deep-sea-blue">
                            <button @click="addShoppingItem" class="bg-deep-sea-blue text-white w-12 h-12 rounded-xl flex-shrink-0"><i class="fa-solid fa-plus"></i></button>
                        </div>
                    </div>
                </div>

                <!-- Expenses View -->
                <div v-show="currentTab === 'expenses'">
                     <div class="p-4">
                        <h2 class="font-bold text-lg text-slate-800 mb-2">個人記帳</h2>
                        <div class="bg-white p-4 rounded-xl shadow-sm border border-gray-100">
                           <div class="text-center">
                               <p class="text-sm text-slate-500">已付總額 (TWD)</p>
                               <p class="text-3xl font-black text-deep-sea-blue my-1">{{ formatNumber(finalTotalTWD) }}</p>
                               <div class="text-xs text-slate-400">THB {{ formatNumber(totalTHB) }} + TWD {{ formatNumber(totalTWD) }}</div>
                           </div>
                        </div>
                    </div>
                    <div class="p-4 pt-0">
                         <div class="bg-white rounded-xl shadow-sm border border-gray-100 divide-y divide-gray-100">
                           <div v-for="expense in expenses.filter(e => e.payer === currentUser)" :key="expense.id" class="p-4 flex items-center">
                               <div class="w-10 h-10 rounded-full flex items-center justify-center text-white" :class="getCategoryColor(expense.category)">
                                    <i :class="getCategoryIcon(expense.category)"></i>
                                </div>
                               <div class="ml-3 flex-grow">
                                   <div class="font-bold text-slate-700">{{ expense.item }}</div>
                                   <div class="text-xs text-slate-400">{{ expense.date }}</div>
                               </div>
                               <div class="text-right">
                                   <div class="font-bold text-slate-800">{{ formatNumber(expense.amount) }} <span class="text-xs text-slate-500">{{ expense.currency }}</span></div>
                               </div>
                               <button @click="editItem(expense, 'expense')" class="ml-4 text-slate-300 hover:text-deep-sea-blue"><i class="fa-solid fa-pencil"></i></button>
                           </div>
                           <div v-if="expenses.filter(e => e.payer === currentUser).length === 0" class="p-6 text-center text-sm text-slate-400">
                                <i class="fa-solid fa-receipt text-2xl mb-2"></i>
                                <p>目前沒有任何記帳</p>
                           </div>
                        </div>
                    </div>
                </div>
            </main>

            <button @click="handleAddClick" v-if="hasSelectedUser" class="fixed bottom-24 right-6 z-40 w-16 h-16 rounded-full bg-gradient-to-r from-deep-sea-blue to-orange-500 text-white shadow-lg flex items-center justify-center text-2xl">
                <i class="fa-solid fa-plus"></i>
            </button>

            <!-- Itinerary Modal -->
            <div v-if="showItineraryModal" class="fixed inset-0 bg-black/50 z-50 flex items-end justify-center" @click.self="showItineraryModal=false">
                <div class="bg-white w-full rounded-t-3xl p-6 animate-slide-up">
                    <h3 class="font-bold text-lg mb-4">{{ isEditMode ? '編輯' : '新增' }}行程</h3>
                     <div class="space-y-4">
                        <input v-model="newItinerary.title" type="text" placeholder="行程標題" class="w-full bg-slate-100 p-3 rounded-xl">
                        <textarea v-model="newItinerary.description" placeholder="描述" class="w-full bg-slate-100 p-3 rounded-xl h-24"></textarea>
                        <div class="grid grid-cols-2 gap-4">
                            <input v-model="newItinerary.time" type="time" placeholder="時間" class="w-full bg-slate-100 p-3 rounded-xl">
                             <select v-model="newItinerary.category" class="w-full bg-slate-100 p-3 rounded-xl">
                                <option value="food">美食</option>
                                <option value="attraction">景點</option>
                                <option value="shopping">購物</option>
                                <option value="activity">活動</option>
                                <option value="transport">交通</option>
                                <option value="hotel">住宿</option>
                            </select>
                        </div>
                        <button @click="saveItineraryItem" class="w-full p-4 bg-deep-sea-blue text-white rounded-xl font-bold">儲存</button>
                    </div>
                </div>
            </div>

            <!-- Expense Modal -->
            <div v-if="showExpenseModal" class="fixed inset-0 bg-black/50 z-50 flex items-end justify-center" @click.self="showExpenseModal=false">
                <div class="bg-white w-full rounded-t-3xl p-6 animate-slide-up">
                    <h3 class="font-bold text-lg mb-4">{{ isEditMode ? '編輯' : '新增' }}記帳</h3>
                     <div class="space-y-4">
                        <input v-model="newExpense.item" type="text" placeholder="項目" class="w-full bg-slate-100 p-3 rounded-xl">
                        <div class="grid grid-cols-3 gap-4">
                            <input v-model="newExpense.amount" type="number" placeholder="金額" class="col-span-2 bg-slate-100 p-3 rounded-xl">
                            <select v-model="newExpense.currency" class="w-full bg-slate-100 p-3 rounded-xl">
                                <option>THB</option>
                                <option>TWD</option>
                            </select>
                        </div>
                         <div class="grid grid-cols-2 gap-4">
                            <input v-model="newExpense.date" type="date" class="w-full bg-slate-100 p-3 rounded-xl">
                            <select v-model="newExpense.category" class="w-full bg-slate-100 p-3 rounded-xl">
                                <option value="food">美食</option>
                                <option value="attraction">景點</option>
                                <option value="shopping">購物</option>
                                <option value="activity">活動</option>
                                <option value="transport">交通</option>
                                <option value="hotel">住宿</option>
                                <option value="other">其他</option>
                            </select>
                        </div>
                        <button @click="saveExpense" class="w-full p-4 bg-deep-sea-blue text-white rounded-xl font-bold">儲存</button>
                    </div>
                </div>
            </div>

            <!-- Footer Navigation -->
            <footer class="footer-nav bg-white shadow-[-4px_0_15px_rgba(0,0,0,0.1)] relative">
                <div class="flex justify-around">
                    <div @click="currentTab = 'itinerary'" class="tab flex-1 text-center py-3 cursor-pointer" :class="{ active: currentTab === 'itinerary' }">
                        <i class="fa-solid fa-route"></i>
                        <span class="block text-xs">行程</span>
                    </div>
                    <div @click="currentTab = 'shopping'" class="tab flex-1 text-center py-3 cursor-pointer" :class="{ active: currentTab === 'shopping' }">
                        <i class="fa-solid fa-bag-shopping"></i>
                        <span class="block text-xs">購物</span>
                    </div>
                    <div @click="currentTab = 'expenses'" class="tab flex-1 text-center py-3 cursor-pointer" :class="{ active: currentTab === 'expenses' }">
                        <i class="fa-solid fa-wallet"></i>
                        <span class="block text-xs">記帳</span>
                    </div>
                </div>
                <div class="tab-indicator" :style="{ width: `${100 / 3}%`, transform: `translateX(${(currentTab === 'itinerary' ? 0 : currentTab === 'shopping' ? 1 : 2) * 100}%)` }"></div>
            </footer>
        </template>
    </div>

    <script type="module">
        import {
            getFirestore,
            collection,
            addDoc,
            onSnapshot,
            doc,
            updateDoc,
            deleteDoc,
            writeBatch,
            getDocs,
            query,
            orderBy,
            serverTimestamp,
        } from "https://www.gstatic.com/firebasejs/9.6.1/firebase-firestore.js";
        import { initializeApp } from "https://www.gstatic.com/firebasejs/9.6.1/firebase-app.js";

        const { createApp, ref, computed, onMounted, nextTick } = Vue;

        const firebaseConfig = {
            // 這裡請填回您的 Firebase 設定
        };

        const appInstance = initializeApp(firebaseConfig);
        const db = getFirestore(appInstance);

        const INITIAL_ITINERARY = [
            [
                { category: "transport", name: "抵達曼谷機場 (BKK)", startTime: "13:05", address: "Suvarnabhumi Airport", note: "下機後辦理通關、領行李，預計 14:00 出關。建議預約保母車或叫 2 台 Grab 前往飯店。", order: 1, transportType: "flight", travelTime: "" },
                { category: "accommodation", name: "入住 Craftsman Bangkok", startTime: "15:00", address: "34-36 Phahon Yothin 11, Samsen Nai, Phaya Thai", note: "Check-in，放行李、分配房卡。稍作休息或在飯店泳池拍照。", order: 2, transportType: "car", travelTime: "機場 → 飯店約 40 分" },
                { category: "food", name: "Ari 咖啡街散步", startTime: "16:00", address: "Ari Soi 4 / Gump's Ari", note: "從飯店搭嘟嘟車或叫車至 Ari。逛 Gump's Ari 拍照，或去 Nana Coffee Roasters 喝咖啡。", order: 3, transportType: "car", travelTime: "飯店 → Ari 區約 15 分" },
                { category: "food", name: "晚餐：Lay Lao (Ari)", startTime: "18:00", address: "65 Phahon Yothin 7, Samsen Nai", note: "米其林必比登推薦東北菜。就在 Ari 站附近，吃完可以直接散步。", order: 4, transportType: "walk", travelTime: "Ari 區步行" },
                { category: "other", name: "按摩 / 放鬆 / 續攤", startTime: "20:00", address: "Ari Area", note: "飯後可找附近按摩店 (Chaari Spa)，或去酒吧/大麻店 chill 一下。結束叫車回飯店。", order: 5, transportType: "walk", travelTime: "步行約 10 分" },
            ],
            [
                { category: "food", name: "早餐：FRAN'S Ari", startTime: "09:00", address: "58 Ngam Duphli Alley", note: "超紅早午餐，務必預約。叫車前往。", order: 1, transportType: "car", travelTime: "飯店 → FRAN'S 約 10 分" },
                { category: "sightseeing", name: "臥佛寺 (Wat Pho)", startTime: "11:00", address: "2 Sanam Chai Rd", note: "從 Ari 叫車去舊城區，預留 40 分鐘車程避開塞車。參觀臥佛。", order: 2, transportType: "car", travelTime: "Ari → 臥佛寺 車程約 40 分" },
                { category: "food", name: "午餐：RONGROS", startTime: "12:30", address: "392/16 Maha Rat Rd", note: "河畔景觀餐廳，看鄭王廟。就在臥佛寺附近的碼頭邊。", order: 3, transportType: "walk", travelTime: "臥佛寺 → RONGROS 步行 5 分" },
                { category: "sightseeing", name: "鄭王廟 (Wat Arun)", startTime: "14:30", address: "158 Thanon Wang Doem", note: "搭接駁船過河。爬塔拍照，停留約 1 小時。", order: 4, transportType: "public", travelTime: "過河船程約 10 分" },
                { category: "shopping", name: "ICONSIAM", startTime: "16:00", address: "299 Charoen Nakhon Rd", note: "從鄭王廟碼頭搭橘旗/藍旗船前往。逛室內水上市場吹冷氣。", order: 5, transportType: "public", travelTime: "鄭王廟 → ICONSIAM 船程 20 分" },
                { category: "sightseeing", name: "碼頭夜市 Asiatique", startTime: "18:30", address: "2194 Charoen Krung Rd", note: "從 ICONSIAM 搭船至 Sathorn，轉免費接駁船。晚餐夜市解決，玩 Skyflyer。", order: 6, transportType: "public", travelTime: "船程約 30 分" },
                { category: "other", name: "Nana 廣場 (夜生活)", startTime: "21:30", address: "Nana Plaza, Sukhumvit 4", note: "體驗曼谷紅燈區氛圍。結束後叫車回 Craftsman。", order: 7, transportType: "car", travelTime: "Asiatique → Nana 車程 30 分" },
            ],
            [
                { category: "accommodation", name: "Craftsman 退房", startTime: "08:30", address: "Craftsman Bangkok", note: "起床吃早餐、收行李退房。包車司機預計 08:30 抵達接人。", order: 1, transportType: "walk", travelTime: "飯店門口上車" },
                { category: "sightseeing", name: "美功鐵道市集", startTime: "10:45", address: "Mae Klong Railway Market", note: "08:45 準時出發，車程約 2 小時。看 11:10/11:30 火車。", order: 2, transportType: "car", travelTime: "曼谷 → 美功 約 2 小時" },
                { category: "food", name: "午餐：廣銘珍 / 媽媽桑", startTime: "11:40", address: "市場旁", note: "看完火車就近吃雲吞麵或泡麵。", order: 3, transportType: "walk", travelTime: "步行" },
                { category: "sightseeing", name: "安帕瓦水上市場", startTime: "13:00", address: "Amphawa", note: "搭車前往，約 20 分鐘。包船遊河，逛市集吃點心。", order: 4, transportType: "car", travelTime: "美功 → 安帕瓦 20 分" },
                { category: "accommodation", name: "入住通羅 Airbnb", startTime: "17:00", address: "Thonglor Area", note: "15:30 離開安帕瓦，預計 17:00-17:30 抵達通羅。Check-in 休息。", order: 5, transportType: "car", travelTime: "安帕瓦 → 通羅 2 小時" },
                { category: "food", name: "晚餐：頌通酒家", startTime: "19:00", address: "2829 Rama IV Rd", note: "老牌海鮮餐廳，必吃咖哩蟹。叫車前往。", order: 6, transportType: "car", travelTime: "通羅 → 頌通 15 分" },
                { category: "other", name: "Tichuca Rooftop Bar", startTime: "21:00", address: "T-One Building", note: "水母酒吧喝一杯。人多需排隊。", order: 7, transportType: "car", travelTime: "頌通 → Tichuca 15 分" },
            ],
            [
                { category: "sightseeing", name: "四面佛", startTime: "10:00", address: "Erawan Shrine", note: "搭 BTS 從 Thong Lo 到 Chit Lom。參拜許願。", order: 1, transportType: "public", travelTime: "BTS 約 20 分" },
                { category: "shopping", name: "Central World", startTime: "10:30", address: "Central World", note: "就在對面，過天橋即達。逛街吹冷氣。", order: 2, transportType: "walk", travelTime: "步行 5 分" },
                { category: "food", name: "午餐：Here Hai (Paragon)", startTime: "12:30", address: "Siam Paragon G Fl", note: "走 Skywalk 到 Paragon。吃米其林蟹肉炒飯。", order: 3, transportType: "walk", travelTime: "步行 10 分" },
                { category: "shopping", name: "Siam 商圈自由逛", startTime: "13:30", address: "Siam Center / Paragon", note: "自由活動時間，買衣服、香氛。", order: 4, transportType: "walk", travelTime: "商圈內" },
                { category: "other", name: "按摩", startTime: "16:00", address: "Siam / Chit Lom", note: "Let's Relax 或其他按摩店放鬆腿部。", order: 5, transportType: "walk", travelTime: "步行" },
                { category: "food", name: "晚餐：Mungkorn Seafood", startTime: "18:30", address: "Pracha Songkhro Rd", note: "搭車前往海鮮吃到飽。大頭蝦無限夾。", order: 6, transportType: "car", travelTime: "Siam → 餐廳 車程 30 分" },
                { category: "shopping", name: "Big C Ekkamai", startTime: "21:00", address: "Sukhumvit 63", note: "吃飽去 Ekkamai 的 Big C 採購伴手禮，人少好逛。離通羅近。", order: 7, transportType: "car", travelTime: "餐廳 → Ekkamai 車程 25 分" },
            ],
            [
                { category: "food", name: "早餐 & 整理行李", startTime: "09:00", address: "Thonglor", note: "通羅附近咖啡廳早餐，最後打包。", order: 1, transportType: "walk", travelTime: "" },
                { category: "accommodation", name: "退房 & 前往機場", startTime: "11:00", address: "Thonglor Airbnb", note: "11:00 準時退房，保母車接送。預留 1 小時車程。", order: 2, transportType: "walk", travelTime: "步行至樓下" },
                { category: "transport", name: "抵達 BKK 機場", startTime: "12:00", address: "Suvarnabhumi Airport", note: "辦理登機、托運、退稅。逛免稅店。", order: 3, transportType: "car", travelTime: "通羅 → 機場 車程 60 分" },
                { category: "flight", name: "搭機返台 (CI0832)", startTime: "14:05", address: "Gate", note: "14:05 起飛，結束旅程。", order: 4, transportType: "flight", travelTime: "機場內" },
            ],
        ];

        const app = createApp({
            setup() {
                const TRIP_YEAR = 2026;
                const EXCHANGE_RATE = ref(0.92);
                const WEATHER_API_KEY = "e5e727b85066927db1d248be29dfa632";
                const currentTab = ref("itinerary");
                const selectedDateIndex = ref(0);
                const showShoppingModal = ref(false);
                const showExpenseModal = ref(false);
                const showItineraryModal = ref(false);
                const showRolePasswordModal = ref(false); // Kept for safety
                
                const loginStep = ref("select");
                
                const isEditMode = ref(false);
                const inputTHB = ref(100);
                const inputTWD = ref(92);
                const rolePasswordInput = ref("");
                const rolePasswordInputRef = ref(null);
                const passwordMode = ref("loginAdmin");
                const targetLoginMember = ref(null);
                const recentlyMovedId = ref(null);
                const isRatesLoading = ref(false);
                const hasSelectedUser = ref(false);
                const currentUser = ref("");
                const showToast = ref(false);
                const toastMessage = ref("");
                const dates = ref([{ date: "1/16", weekday: "五", hasCar: false }, { date: "1/17", weekday: "六", hasCar: false }, { date: "1/18", weekday: "日", hasCar: true }, { date: "1/19", weekday: "一", hasCar: false }, { date: "1/20", weekday: "二", hasCar: false }]);
                const weatherData = ref([]);
                const itineraryData = ref([[], [], [], [], []]);
                const members = ref([]);
                const allShoppingList = ref([]);
                const expenses = ref([]);
                const newShoppingItem = ref({ name: "", checked: false });
                const newItinerary = ref({});
                const newExpense = ref({});
                const ROLE_PASSWORD = "kappaho17";
                const DEFAULT_MEMBERS = ["kappabooom", "beibei1029", "hsiannnnng", "shinbinwei", "aylwen4444", "wunsin", "rtrtr1", "blackblacknu"];

                const currentUserRole = computed(() => { const m = members.value.find(m => m.name === currentUser.value); return m?.role || "viewer"; });
                const canEditItinerary = computed(() => currentUserRole.value === "admin");
                const currentShoppingList = computed(() => allShoppingList.value.filter(item => item.owner === currentUser.value));
                const totalTHB = computed(() => expenses.value.filter(e => e.payer === currentUser.value && e.currency === 'THB').reduce((a, b) => a + (Number(b.amount) || 0), 0));
                const totalTWD = computed(() => expenses.value.filter(e => e.payer === currentUser.value && e.currency === 'TWD').reduce((a, b) => a + (Number(b.amount) || 0), 0));
                const finalTotalTWD = computed(() => Math.round(totalTWD.value + totalTHB.value * EXCHANGE_RATE.value));
                const currentItinerary = computed(() => (itineraryData.value[selectedDateIndex.value] || []).sort((a, b) => (a.order || 999) - (b.order || 999)));

                const triggerToast = (msg) => { toastMessage.value = msg; showToast.value = true; setTimeout(() => showToast.value = false, 3000); };
                const formatNumber = (num) => num ? num.toString().replace(/\B(?=(\d{3})+(?!\d))/g, ",") : "0";

                onMounted(async () => {
                    try {
                        const membersCol = collection(db, "members");
                        onSnapshot(query(membersCol, orderBy("name")), (snapshot) => {
                            if (!snapshot.empty) {
                                members.value = snapshot.docs.map(d => ({ id: d.id, ...d.data() }));
                            } else {
                                DEFAULT_MEMBERS.forEach(name => addDoc(membersCol, { name, active: true, role: 'viewer', password: '' }));
                            }
                        });

                        onSnapshot(collection(db, "expenses"), (snapshot) => expenses.value = snapshot.docs.map(d => ({ id: d.id, ...d.data() })));
                        onSnapshot(collection(db, "shopping_list"), (snapshot) => allShoppingList.value = snapshot.docs.map(d => ({ id: d.id, ...d.data() })));

                        for (let i = 0; i < dates.value.length; i++) {
                            const itineraryCol = collection(db, `itinerary_day_${i}`);
                            const snap = await getDocs(itineraryCol);
                            if (snap.empty && INITIAL_ITINERARY[i]) {
                                const batch = writeBatch(db);
                                INITIAL_ITINERARY[i].forEach(item => batch.set(doc(itineraryCol), item));
                                await batch.commit();
                            }
                            onSnapshot(itineraryCol, (snapshot) => itineraryData.value[i] = snapshot.docs.map(doc => ({ ...doc.data(), id: doc.id })));
                        }

                        try { await fetchWeatherData(); } catch (e) { console.error("Weather fetch failed:", e); }
                        try { await fetchExchangeRate(); } catch (e) { console.error("Rates fetch failed:", e); }

                    } catch (e) { console.error("Firebase init error: ", e); }
                });

                const fetchWeatherData = async () => {
                    const lat = 13.7563; 
                    const lon = 100.5018; 
                    const url = `https://api.openweathermap.org/data/2.5/forecast?lat=${lat}&lon=${lon}&appid=${WEATHER_API_KEY}&units=metric&lang=zh_tw`;
                    
                    const now = new Date();
                    const tripStart = new Date(`${TRIP_YEAR}-01-16`);
                    const daysUntilTrip = Math.ceil((tripStart - now) / (1000 * 60 * 60 * 24));

                    if (daysUntilTrip > 5) {
                        weatherData.value = dates.value.map(() => ({
                            temp: "33/24",
                            feel: "36",
                            condition: "Clear",
                            is_realtime: false,
                        }));
                        return;
                    }

                    try {
                        const response = await fetch(url);
                        const data = await response.json();
                        const dailyData = {};
                        data.list.forEach(item => {
                            const date = new Date(item.dt * 1000).toLocaleDateString('en-CA');
                            if (!dailyData[date]) {
                                dailyData[date] = { temps: [], feels: [], conditions: [], icons: [] };
                            }
                            dailyData[date].temps.push(item.main.temp);
                            dailyData[date].feels.push(item.main.feels_like);
                            dailyData[date].conditions.push(item.weather[0].main);
                            dailyData[date].icons.push(item.weather[0].icon);
                        });

                        const tripDates = dates.value.map(d => `${TRIP_YEAR}-${d.date.replace('/', '-')}`);
                        weatherData.value = tripDates.map(d_str => {
                            const d_obj = new Date(d_str);
                            const key = d_obj.toLocaleDateString('en-CA');
                            if (dailyData[key]) {
                                const day = dailyData[key];
                                const max_temp = Math.round(Math.max(...day.temps));
                                const min_temp = Math.round(Math.min(...day.temps));
                                const avg_feel = Math.round(day.feels.reduce((a,b) => a+b, 0) / day.feels.length);
                                return {
                                    temp: `${max_temp}/${min_temp}`,
                                    feel: `${avg_feel}`,
                                    condition: day.conditions[Math.floor(day.conditions.length/2)], // Mid-day condition
                                    is_realtime: true,
                                };
                            }
                            return { temp: "?/?", feel: "?", condition: "Unknown", is_realtime: false };
                        });
                    } catch (error) {
                        console.error("Error fetching weather:", error);
                    }
                };

                const fetchExchangeRate = async () => {
                    isRatesLoading.value = true;
                    try {
                        const response = await fetch('https://api.exchangerate-api.com/v4/latest/THB');
                        const data = await response.json();
                        EXCHANGE_RATE.value = data.rates.TWD;
                        updateTWD();
                    } catch (error) {
                        console.error("Error fetching exchange rate:", error);
                        triggerToast("匯率更新失敗");
                    } finally {
                        isRatesLoading.value = false;
                    }
                };

                const attemptLogin = (member) => {
                    targetLoginMember.value = member;
                    if (member.role === "admin") {
                        passwordMode.value = "loginAdmin";
                        rolePasswordInput.value = "";
                        loginStep.value = "password"; 
                    } else if (member.password) {
                        passwordMode.value = "loginPersonal";
                        rolePasswordInput.value = "";
                        loginStep.value = "password"; 
                    } else {
                        performLogin(member);
                        return;
                    }
                    
                    nextTick(() => {
                        if (rolePasswordInputRef.value) {
                            rolePasswordInputRef.value.focus();
                        }
                    });
                };

                const performLogin = (member) => { currentUser.value = member.name; hasSelectedUser.value = true; };

                const confirmRolePassword = async () => {
                    const input = rolePasswordInput.value;
                    if (passwordMode.value === "loginAdmin" && input === ROLE_PASSWORD) {
                        performLogin(targetLoginMember.value);
                        loginStep.value = "select"; 
                    } else if (passwordMode.value === "loginPersonal" && input === targetLoginMember.value.password) {
                        performLogin(targetLoginMember.value);
                        loginStep.value = "select"; 
                    } else {
                        triggerToast("密碼錯誤");
                    }
                };
                
                const cancelRolePassword = () => {
                    loginStep.value = "select";
                    rolePasswordInput.value = "";
                };
                
                const updateTWD = () => inputTWD.value = Math.round(inputTHB.value * EXCHANGE_RATE.value);
                const updateTHB = () => inputTHB.value = Math.round(inputTWD.value / EXCHANGE_RATE.value * 100) / 100;

                const getCategoryIcon = (category) => ({
                    food: "fa-solid fa-utensils",
                    attraction: "fa-solid fa-camera-retro",
                    shopping: "fa-solid fa-bag-shopping",
                    activity: "fa-solid fa-person-swimming",
                    transport: "fa-solid fa-train-subway",
                    hotel: "fa-solid fa-bed",
                    other: "fa-solid fa-circle"
                }[category] || "fa-solid fa-question-circle");

                const getCategoryColor = (category) => ({
                    food: "bg-red-400",
                    attraction: "bg-blue-400",
                    shopping: "bg-purple-400",
                    activity: "bg-yellow-500",
                    transport: "bg-green-400",
                    hotel: "bg-indigo-400",
                    other: "bg-gray-400"
                }[category] || "bg-gray-400");
                
                const getTransportIcon = (method) => ({
                    walk: "fa-solid fa-person-walking",
                    car: "fa-solid fa-car",
                    train: "fa-solid fa-train-subway"
                }[method] || "fa-solid fa-circle-question");

                const getWeatherIcon = (condition) => {
                    const c = condition.toLowerCase();
                    if (c.includes('rain')) return 'fa-solid fa-cloud-showers-heavy';
                    if (c.includes('cloud')) return 'fa-solid fa-cloud';
                    if (c.includes('clear')) return 'fa-solid fa-sun';
                    if (c.includes('storm')) return 'fa-solid fa-cloud-bolt';
                    return 'fa-solid fa-smog';
                };
                const getWeatherDescription = (condition) => {
                    const c = condition.toLowerCase();
                    if (c.includes('rain')) return '有雨';
                    if (c.includes('cloud')) return '多雲';
                    if (c.includes('clear')) return '晴朗';
                    if (c.includes('storm')) return '風暴';
                    return '未知';
                };

                const handleAddClick = () => {
                    isEditMode.value = false;
                    if (currentTab.value === 'itinerary') {
                        newItinerary.value = { category: 'food', order: currentItinerary.value.length };
                        showItineraryModal.value = true;
                    } else if (currentTab.value === 'expenses') {
                        newExpense.value = { 
                            currency: 'THB',
                            category: 'food', 
                            payer: currentUser.value,
                            date: new Date().toISOString().split('T')[0]
                        };
                        showExpenseModal.value = true;
                    }
                };

                const editItem = (item, type) => {
                    isEditMode.value = true;
                    if (type === 'itinerary') {
                        newItinerary.value = { ...item };
                        showItineraryModal.value = true;
                    } else if (type === 'expense') {
                        newExpense.value = { ...item };
                        showExpenseModal.value = true;
                    }
                };

                const saveItineraryItem = async () => {
                    if (!newItinerary.value.title) return;
                    const colRef = collection(db, `itinerary_day_${selectedDateIndex.value}`);
                    try {
                        if (isEditMode.value) {
                            const docRef = doc(colRef, newItinerary.value.id);
                            await updateDoc(docRef, newItinerary.value);
                            triggerToast("行程已更新");
                        } else {
                            await addDoc(colRef, newItinerary.value);
                            triggerToast("行程已新增");
                        }
                        showItineraryModal.value = false;
                    } catch (e) {
                        console.error(e);
                        triggerToast("儲存失敗");
                    }
                };
                
                const moveItem = async (item, direction) => {
                    const list = currentItinerary.value;
                    const fromIndex = list.findIndex(i => i.id === item.id);
                    if (fromIndex === -1) return;
                    
                    const toIndex = direction === 'up' ? fromIndex - 1 : fromIndex + 1;
                    if (toIndex < 0 || toIndex >= list.length) return;

                    const batch = writeBatch(db);
                    const colRef = collection(db, `itinerary_day_${selectedDateIndex.value}`);
                    
                    const itemToMove = list[fromIndex];
                    const otherItem = list[toIndex];

                    const newOrderForMoved = otherItem.order;
                    const newOrderForOther = itemToMove.order;

                    batch.update(doc(colRef, itemToMove.id), { order: newOrderForMoved });
                    batch.update(doc(colRef, otherItem.id), { order: newOrderForOther });

                    try {
                        await batch.commit();
                        recentlyMovedId.value = itemToMove.id;
                        setTimeout(() => recentlyMovedId.value = null, 1500);
                    } catch (e) {
                        console.error("Move failed:", e);
                        triggerToast("移動失敗");
                    }
                };

                const addShoppingItem = async () => {
                    if (!newShoppingItem.value.name.trim()) return;
                    await addDoc(collection(db, "shopping_list"), {
                        name: newShoppingItem.value.name,
                        checked: false,
                        owner: currentUser.value
                    });
                    newShoppingItem.value.name = "";
                };

                const toggleShoppingItem = async (item) => {
                    const docRef = doc(db, "shopping_list", item.id);
                    await updateDoc(docRef, { checked: !item.checked });
                };

                const removeShoppingItem = async (id) => {
                    await deleteDoc(doc(db, "shopping_list", id));
                };

                const saveExpense = async () => {
                    if (!newExpense.value.item || !newExpense.value.amount) return;
                    try {
                        if (isEditMode.value) {
                            const docRef = doc(db, "expenses", newExpense.value.id);
                            await updateDoc(docRef, newExpense.value);
                             triggerToast("記帳已更新");
                        } else {
                            await addDoc(collection(db, "expenses"), newExpense.value);
                             triggerToast("記帳已新增");
                        }
                        showExpenseModal.value = false;
                    } catch(e) {
                        console.error(e);
                        triggerToast("儲存失敗");
                    }
                };

                return {
                    currentTab, selectedDateIndex, showShoppingModal, showExpenseModal, showItineraryModal, showRolePasswordModal,
                    dates, weatherData, currentItinerary, members, currentShoppingList,
                    newShoppingItem, newExpense, newItinerary, rolePasswordInput, rolePasswordInputRef, passwordMode, targetLoginMember,
                    currentUser, hasSelectedUser, currentUserRole, canEditItinerary, totalTHB, totalTWD, finalTotalTWD,
                    inputTHB, inputTWD, EXCHANGE_RATE, isRatesLoading, showToast, toastMessage, recentlyMovedId,
                    attemptLogin, confirmRolePassword, cancelRolePassword,
                    getCategoryIcon, getTransportIcon, getCategoryColor, getWeatherIcon, getWeatherDescription, formatNumber,
                    handleAddClick, editItem, saveItineraryItem, addShoppingItem, toggleShoppingItem, removeShoppingItem, saveExpense, moveItem,
                    updateTWD, updateTHB, fetchExchangeRate, performLogin, loginStep
                };
            },
        });

        app.mount("#app");
    </script>
</body>
</html>
