<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>2026曼谷旅行</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
    
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        // 修改為暖色調/度假風格
                        'snow-white': '#FFFDE7',       // 暖象牙白 (原雪白)
                        'ice-blue': '#4DB6AC',         // 海洋綠 (原冰川藍)
                        'light-snow-blue': '#FFF3E0',  // 溫暖淺橘底色 (原淺藍底色)
                        'deep-sea-blue': '#E65100',    // 夕陽深橘 (原深海藍 - 文字/強調)
                        'accent-yellow': '#FFB300',    // 熱帶金黃 (原溫暖黃)
                        'soft-gray': '#FAFAFA'         // 背景灰
                    }
                }
            }
        }
    </script>

    <style>
        @import url('https://fonts.googleapis.com/css?family=Noto+Sans+TC:wght@300;400;500;700&display=swap');

        body {
            background-color: #FFF3E0; /* 暖色背景 */
            -webkit-tap-highlight-color: transparent;
            font-family: 'Noto Sans TC', sans-serif;
            color: #334155;
        }

        .app-container {
            max-width: 480px;
            margin: 0 auto;
            min-height: 100vh;
            background-color: #ffffff;
            box-shadow: 0 0 30px rgba(0, 0, 0, 0.05);
            position: relative;
            padding-bottom: 90px;
        }

        .header-bg {
            background-color: #ffffff;
            padding: 0;
            position: relative;
            overflow: hidden;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.15);
            border-bottom-left-radius: 35px;
            border-bottom-right-radius: 35px;
            z-index: 10;
        }

        .header-image-container {
            width: 100%;
            height: 250px;
            overflow: hidden;
            background-color: transparent;
            border-bottom-left-radius: 35px;
            border-bottom-right-radius: 35px;
        }

        .header-image-container img {
            width: 100%;
            height: 100%;
            object-fit: cover;
            display: block;
        }

        /* 移除原本的 .snow-layer 與 @keyframes snowfall */

        /* Tab 按鈕樣式 */
        .side-tab-bar {
            position: absolute;
            bottom: 45px;
            right: 16px;
            z-index: 30;
            display: flex;
            flex-direction: row;
            gap: 8px;
        }

        .tab-button {
            width: 40px;
            height: 40px;
            border-radius: 9999px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.125rem;
            box-shadow: 0 4px 10px rgba(0,0,0,0.15);
            transition: all 0.2s ease;
            border: none;
            cursor: pointer;
        }

        .tab-button.active {
            background-color: #E65100; /* deep-sea-blue (orange) */
            color: #ffffff;
            box-shadow: 0 6px 15px rgba(230, 81, 0, 0.4);
            transform: scale(1.05);
        }

        .tab-button:not(.active) {
            background-color: #ffffff;
            color: #4DB6AC; /* ice-blue (teal) */
        }

        .app-main {
            padding-top: 25px !important;
            position: relative;
            z-index: 5;
        }

        .hide-scrollbar::-webkit-scrollbar {
            display: none;
        }
        .hide-scrollbar {
            -ms-overflow-style: none;
            scrollbar-width: none;
        }

        .card-shadow {
            box-shadow: 0 4px 20px rgba(230, 81, 0, 0.1); /* 調整陰影顏色 */
            transition: transform 0.2s ease, box-shadow 0.2s ease;
        }

        .animate-fade-in {
            animation: fadeIn 0.4s ease-out;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .fab-shadow {
            box-shadow: 0 4px 15px rgba(255, 179, 0, 0.5);
        }

        .note-content {
            max-height: 2.5rem;
            overflow: hidden;
            transition: max-height 0.3s ease-out;
        }
        .note-content.expanded {
            max-height: 500px;
        }

        /* 支出頁 Banner 改為熱帶夕陽漸層 */
        .expenses-banner {
            background: linear-gradient(135deg, #FF7043 0%, #AB47BC 100%);
        }

        .date-selector-sticky {
            background-color: #ffffff;
            border-bottom: 1px solid #f0f0f0;
            z-index: 20;
            top: 0;
        }
    </style>
</head>
<body>
    <div id="app" class="app-container">
        <div class="header-bg relative">
            <div class="header-image-container">
                <img src="banner.png" alt="曼谷家族旅行計畫">
            </div>
            <div class="side-tab-bar">
                <button @click="currentTab = 'itinerary'" title="行程" :class="{'active': currentTab === 'itinerary'}" class="tab-button">
                    <i class="fa-solid fa-map-location-dot"></i>
                </button>
                <button @click="currentTab = 'info'" title="資訊" :class="{'active': currentTab === 'info'}" class="tab-button">
                    <i class="fa-solid fa-circle-info"></i>
                </button>
                <button @click="currentTab = 'shopping'" title="購物" :class="{'active': currentTab === 'shopping'}" class="tab-button">
                    <i class="fa-solid fa-basket-shopping"></i>
                </button>
                <button @click="currentTab = 'expenses'" title="花費" :class="{'active': currentTab === 'expenses'}" class="tab-button">
                    <i class="fa-solid fa-coins"></i>
                </button>
            </div>
        </div>

        <main class="p-4 app-main">
            <div v-if="currentTab === 'itinerary'" class="animate-fade-in">
                <div class="flex overflow-x-auto hide-scrollbar space-x-3 pb-4 mb-2 snap-x px-1 sticky date-selector-sticky pt-1 -mx-4 px-4">
                    <div v-for="(day, index) in dates" :key="index" @click="selectedDateIndex = index"
                         class="snap-center flex-shrink-0 w-[58px] h-[68px] rounded-xl flex flex-col items-center justify-center cursor-pointer transition-all duration-300 border-2 shadow-sm"
                         :class="selectedDateIndex === index ? 'bg-deep-sea-blue text-white border-deep-sea-blue shadow-lg scale-105' : 'bg-white text-slate-400 border-white hover:bg-soft-gray'">
                        <span class="text-sm font-bold uppercase tracking-wider">{{ day.weekday }}</span>
                        <span class="text-xs font-medium opacity-70">{{ day.date }}</span>
                    </div>
                </div>

                <div v-if="weatherData[selectedDateIndex]" class="mb-4 bg-snow-white border border-ice-blue rounded-2xl p-4 flex justify-between items-center shadow-md">
                    <div class="flex items-start text-deep-sea-blue space-x-4">
                        <i :class="getWeatherIcon(weatherData[selectedDateIndex].condition)" class="text-5xl text-accent-yellow"></i>
                        <div class="pt-1">
                            <span class="text-3xl font-extrabold leading-none">{{ weatherData[selectedDateIndex].temp.split('/')[0] }}°</span>
                            <span class="text-sm font-light text-slate-500 ml-1">/ {{ weatherData[selectedDateIndex].temp.split('/')[1] }}°C</span>
                            <span class="block text-xs text-slate-600 mt-1">體感: {{ weatherData[selectedDateIndex].feel }}°C</span>
                        </div>
                    </div>
                    <div class="text-right text-xs text-slate-600 pl-3">
                        <span class="font-bold block text-slate-700">{{ getWeatherDescription(weatherData[selectedDateIndex].condition) }}</span>
                        <span v-if="dates[selectedDateIndex].hasCar" class="mt-1 block text-deep-sea-blue font-bold">
                            <i class="fa-solid fa-car-side mr-1 text-accent-yellow"></i> 租車日
                        </span>
                        <span v-else class="mt-1 block text-slate-400">本日步行/大眾運輸</span>
                    </div>
                </div>

                <div class="space-y-4">
                    <div v-for="(item, idx) in currentItinerary" :key="item.id" class="relative group">
                        <div v-if="idx > 0" class="pl-8 pb-2 flex items-center text-xs text-slate-400">
                            <div class="h-6 w-0.5 bg-slate-200 absolute left-6 -top-3"></div>
                            <i :class="getTransportIcon(item.transportType)" 
                               class="mr-2 text-slate-300 cursor-pointer hover:text-deep-sea-blue transition-colors"
                               @click="openMapDirections(currentItinerary[idx - 1], item)"></i>
                            <span class="font-bold">{{ item.travelTime || '約15分鐘' }}</span>
                        </div>

                        <div class="bg-white rounded-3xl p-5 card-shadow relative overflow-hidden flex items-start border border-ice-blue/50">
                            <div class="mr-4 flex flex-col items-center min-w-[50px]">
                                <div class="p-2 rounded-full text-white shadow-md text-base mb-1" :style="{ backgroundColor: getCategoryColor(item.category) }">
                                    <i :class="getCategoryIcon(item.category)"></i>
                                </div>
                                <span v-if="item.startTime" class="text-xs font-bold text-slate-600 mt-1">{{ item.startTime }}</span>
                            </div>
                            <div class="flex-1 pb-1">
                                <h3 class="text-lg font-bold text-slate-800 mb-1 leading-tight pr-8">{{ item.name }}</h3>
                                <div class="text-sm text-slate-500 space-y-1.5 mt-2">
                                    <p v-if="item.hours" class="flex items-center"><i class="fa-regular fa-clock w-4 text-center mr-2 text-ice-blue"></i> 營業: {{ item.hours }}</p>
                                    <p v-if="item.price" class="flex items-center"><i class="fa-solid fa-ticket w-4 text-center mr-2 text-ice-blue"></i> 費用: {{ item.price }}</p>
                                    <p v-if="item.address" class="flex items-start"><i class="fa-solid fa-location-dot w-4 text-center mr-2 mt-1 text-ice-blue"></i> {{ item.address }}</p>
                                </div>
                                <div v-if="item.note && item.note.length > 0" class="mt-3 text-xs bg-slate-50 p-2.5 rounded-lg border border-slate-100">
                                    <p class="text-slate-600 font-bold mb-1 flex items-center">
                                        <i class="fa-solid fa-highlighter text-accent-yellow mr-2"></i> 備註
                                    </p>
                                    <div class="note-content" :class="{'expanded': item.isNoteExpanded}">
                                        {{ item.note }}
                                    </div>
                                    <button v-if="item.note.length > 50" @click="item.isNoteExpanded = !item.isNoteExpanded" class="text-deep-sea-blue font-bold mt-1 block">
                                        {{ item.isNoteExpanded ? '收合備註' : '查看更多...' }}
                                    </button>
                                </div>
                            </div>
                            <div class="absolute top-3 right-3 flex flex-col space-y-1">
                                <button v-if="idx > 0" @click.stop="moveItinerary(item.id, -1)" class="w-7 h-7 bg-slate-100 text-slate-500 rounded-full flex items-center justify-center text-xs hover:bg-slate-300 transition-colors">
                                    <i class="fa-solid fa-arrow-up"></i>
                                </button>
                                <button v-if="idx < currentItinerary.length - 1" @click.stop="moveItinerary(item.id, 1)" class="w-7 h-7 bg-slate-100 text-slate-500 rounded-full flex items-center justify-center text-xs hover:bg-slate-300 transition-colors">
                                    <i class="fa-solid fa-arrow-down"></i>
                                </button>
                                <button @click.stop="openMap(item.address || item.name)" class="w-7 h-7 bg-ice-blue text-white rounded-full flex items-center justify-center text-xs hover:bg-deep-sea-blue transition-colors">
                                    <i class="fa-solid fa-location-arrow"></i>
                                </button>
                                <button @click.stop="editItem(item)" class="w-7 h-7 bg-slate-100 text-slate-500 rounded-full flex items-center justify-center text-xs hover:bg-slate-200 transition-colors">
                                    <i class="fa-solid fa-pencil"></i>
                                </button>
                            </div>
                        </div>
                    </div>

                    <div v-if="currentItinerary.length === 0" class="text-center py-16 text-slate-300">
                        <i class="fa-solid fa-map-location-dot text-5xl mb-3 text-slate-200"></i>
                        <p class="text-sm">本日尚無行程<br>請點擊右下角新增</p>
                    </div>
                </div>
            </div>

            <div v-if="currentTab === 'info'" class="space-y-5 animate-fade-in">
                <div class="bg-gradient-to-r from-deep-sea-blue to-orange-700 rounded-3xl p-6 text-white shadow-xl relative overflow-hidden">
                    <div class="absolute top-0 right-0 w-32 h-32 bg-white/10 rounded-full -mr-10 -mt-10 blur-2xl"></div>
                    <div class="absolute bottom-0 left-0 w-32 h-32 bg-white/10 rounded-full -ml-10 -mb-10 blur-2xl"></div>
                    <h3 class="font-bold text-lg mb-4 flex items-center relative z-10"><i class="fa-solid fa-calculator mr-2"></i> 匯率換算</h3>
                    <div class="flex items-center justify-between space-x-3 relative z-10">
                        <div class="flex-1">
                            <label class="text-[10px] text-orange-200 block mb-1 uppercase tracking-wider">THB (泰銖)</label>
                            <input type="number" v-model="currencyInput" @input="calculateCurrency" class="w-full bg-white/20 border border-white/30 rounded-xl px-3 py-2.5 text-white placeholder-white/50 focus:outline-none focus:bg-white/30 text-lg font-bold" placeholder=" ">
                        </div>
                        <i class="fa-solid fa-arrow-right-arrow-left text-orange-300 mt-5"></i>
                        <div class="flex-1">
                            <label class="text-[10px] text-orange-200 block mb-1 uppercase tracking-wider">TWD (台幣)</label>
                            <div class="w-full bg-white/10 rounded-xl px-3 py-2.5 text-white text-lg font-bold border border-transparent">
                                $ {{ currencyResult }}
                            </div>
                        </div>
                    </div>
                    <p class="text-[10px] text-orange-200 mt-3 text-right relative z-10">匯率基準: 0.92</p>
                </div>

                <div class="bg-white rounded-3xl p-5 card-shadow">
                    <h3 class="font-bold text-slate-800 mb-3 border-b border-slate-100 pb-2"><i class="fa-solid fa-plane-departure text-blue-500 mr-2"></i> 航班資訊</h3>
                    <div class="space-y-4">
                        <div class="bg-blue-50 rounded-xl p-3 border border-blue-100">
                            <div class="flex justify-between text-sm font-bold text-deep-sea-blue mb-1">
                                <span>TPE 台北</span>
                                <i class="fa-solid fa-plane text-xs"></i>
                                <span>BKK 曼谷</span>
                            </div>
                            <div class="flex justify-between text-xs text-slate-500">
                                <span>10:05</span>
                                <span>CI0831 (1/16)</span>
                                <span>13:05</span>
                            </div>
                        </div>
                        <div class="bg-orange-50 rounded-xl p-3 border border-orange-100">
                            <div class="flex justify-between text-sm font-bold text-orange-800 mb-1">
                                <span>BKK 曼谷</span>
                                <i class="fa-solid fa-plane text-xs"></i>
                                <span>TPE 台北</span>
                            </div>
                            <div class="flex justify-between text-xs text-slate-500">
                                <span>14:05</span>
                                <span>CI0832 (1/20)</span>
                                <span>18:40</span>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="bg-white rounded-3xl p-6 card-shadow">
                    <h3 class="font-bold text-slate-800 mb-4 border-b border-slate-100 pb-3"><i class="fa-solid fa-hotel text-indigo-500 mr-2"></i> 住宿資訊</h3>
                    <ul class="space-y-5">
                        <li v-for="hotel in hotels" class="border-b last:border-0 pb-4 last:pb-0">
                            <div class="flex justify-between items-start group">
                                <div class="flex-1">
                                    <span class="font-bold block text-slate-700 text-lg">{{ hotel.name }}</span>
                                    <span class="text-xs text-slate-400 bg-slate-100 px-2 py-0.5 rounded-full inline-block mt-1">{{ hotel.date }}</span>
                                </div>
                                <button @click="openMap(hotel.name)" class="w-8 h-8 rounded-full bg-indigo-50 text-indigo-500 flex items-center justify-center group-hover:bg-indigo-500 group-hover:text-white transition-all"><i class="fa-solid fa-location-arrow text-xs"></i></button>
                            </div>
                            <div class="text-sm text-slate-500 mt-2 space-y-1">
                                <p class="flex items-center"><i class="fa-solid fa-phone w-5 text-center mr-1 text-slate-300"></i> {{ hotel.phone }}</p>
                                <p class="flex items-start"><i class="fa-solid fa-map-pin w-5 text-center mr-1 mt-1 text-slate-300"></i> {{ hotel.address }}</p>
                            </div>
                        </li>
                    </ul>
                </div>

                <div class="bg-red-50 rounded-3xl p-6 border border-red-100">
                    <h3 class="font-bold text-red-800 mb-4"><i class="fa-solid fa-kit-medical mr-2"></i> 緊急聯絡</h3>
                    <div class="grid grid-cols-2 gap-4 text-center">
                        <a href="tel:191" class="bg-white py-3 rounded-xl shadow-sm text-red-600 font-bold block border border-red-100 hover:bg-red-600 hover:text-white transition-all">
                            <i class="fa-solid fa-user-shield mr-1"></i> 警察 191
                        </a>
                        <a href="tel:1669" class="bg-white py-3 rounded-xl shadow-sm text-red-600 font-bold block border border-red-100 hover:bg-red-600 hover:text-white transition-all">
                            <i class="fa-solid fa-truck-medical mr-1"></i> 救護 1669
                        </a>
                    </div>
                </div>
            </div>

            <div v-if="currentTab === 'shopping'" class="animate-fade-in">
                <div class="bg-white rounded-3xl p-6 card-shadow min-h-[60vh]">
                    <h3 class="font-bold text-slate-800 mb-4 flex items-center justify-between">
                        <span><i class="fa-solid fa-basket-shopping text-accent-yellow mr-2"></i> 購物清單</span>
                        <span class="text-xs bg-slate-100 text-slate-500 px-2 py-1 rounded-lg">{{ shoppingList.length }} 項</span>
                    </h3>
                    
                    <ul class="space-y-3" v-if="shoppingList.length > 0">
                        <li v-for="(item, index) in shoppingList" :key="index" class="flex items-center justify-between p-3 bg-slate-50 rounded-xl border border-slate-100">
                            <div class="flex items-center">
                                <input type="checkbox" v-model="item.checked" class="w-5 h-5 text-deep-sea-blue rounded focus:ring-deep-sea-blue border-gray-300 mr-3 accent-deep-sea-blue">
                                <span :class="{'line-through text-slate-400': item.checked, 'text-slate-700 font-medium': !item.checked}">{{ item.name }}</span>
                            </div>
                            <button @click="removeShoppingItem(index)" class="text-slate-300 hover:text-red-500 transition-colors">
                                <i class="fa-solid fa-trash-can"></i>
                            </button>
                        </li>
                    </ul>

                    <div v-else class="text-center py-12 text-slate-300">
                        <i class="fa-solid fa-bag-shopping text-5xl mb-3 text-slate-200"></i>
                        <p class="text-sm">購物清單空白<br>請點擊右下角新增</p>
                    </div>
                </div>
            </div>

            <div v-if="currentTab === 'expenses'" class="animate-fade-in">
                <div class="expenses-banner text-white rounded-3xl p-8 mb-6 relative overflow-hidden">
                    <div class="absolute -right-10 -top-10 bg-white/10 w-48 h-48 rounded-full blur-3xl"></div>
                    <div class="absolute -left-10 -bottom-10 bg-white/20 w-40 h-40 rounded-full blur-2xl"></div>
                    <p class="text-sm text-orange-100 mb-2 relative z-10">目前總花費 (THB)</p>
                    <h2 class="text-5xl font-bold relative z-10 tracking-tight">฿ {{ formatNumber(totalExpensesJPY) }}</h2>
                    <p class="text-sm text-right mt-2 opacity-80 relative z-10">約 NT$ {{ formatNumber(totalExpensesTWD) }}</p>
                </div>

                <div class="bg-white rounded-3xl p-6 card-shadow">
                    <h3 class="font-bold text-slate-800 mb-4">最近支出</h3>
                    <ul class="space-y-4">
                        <li v-for="(exp, idx) in expenses" :key="idx" class="flex items-center justify-between border-b border-slate-50 last:border-0 pb-3 last:pb-0">
                            <div class="flex items-center">
                                <div class="w-10 h-10 rounded-full bg-slate-100 flex items-center justify-center mr-3 text-slate-500">
                                    <i :class="getCategoryIcon(exp.category)"></i>
                                </div>
                                <div>
                                    <p class="font-bold text-slate-700 text-sm">{{ exp.name }}</p>
                                    <p class="text-xs text-slate-400">{{ exp.date }}</p>
                                </div>
                            </div>
                            <div class="text-right">
                                <p class="font-bold text-deep-sea-blue">฿{{ formatNumber(exp.amount) }}</p>
                                <p class="text-xs text-slate-400 uppercase">{{ exp.payment }}</p>
                            </div>
                        </li>
                    </ul>
                </div>
            </div>
        </main>

        <button v-if="currentTab !== 'info'" @click="handleAddClick" class="fixed bottom-6 right-6 w-14 h-14 bg-accent-yellow rounded-full fab-shadow text-deep-sea-blue text-2xl flex items-center justify-center hover:scale-110 transition-transform z-40">
            <i class="fa-solid fa-plus"></i>
        </button>

        <div v-if="showShoppingModal" class="fixed inset-0 bg-deep-sea-blue/40 z-50 flex items-center justify-center p-6 backdrop-blur-sm animate-fade-in">
            <div class="bg-white rounded-3xl w-full max-w-sm p-6 shadow-2xl">
                <h3 class="font-bold text-lg mb-5 text-center text-slate-800">新增購物清單</h3>
                <input v-model="newShoppingItem.name" type="text" placeholder="商品名稱" class="w-full bg-slate-50 border-none rounded-xl p-4 mb-4 focus:ring-2 focus:ring-deep-sea-blue text-sm outline-none">
                <div class="flex space-x-3">
                    <button @click="showShoppingModal = false" class="flex-1 py-3 rounded-xl bg-slate-100 text-slate-500 font-bold text-sm">取消</button>
                    <button @click="addShoppingItem" class="flex-1 py-3 rounded-xl bg-deep-sea-blue text-white font-bold text-sm shadow-lg shadow-deep-sea-blue/30">新增</button>
                </div>
            </div>
        </div>

        <div v-if="showExpenseModal" class="fixed inset-0 bg-deep-sea-blue/40 z-50 flex items-center justify-center p-6 backdrop-blur-sm animate-fade-in">
            <div class="bg-white rounded-3xl w-full max-w-sm p-6 shadow-2xl">
                <h3 class="font-bold text-lg mb-5 text-center text-slate-800">記一筆 (THB)</h3>
                <div class="space-y-3">
                    <input v-model="newExpense.date" type="date" class="w-full bg-slate-50 rounded-xl p-3 text-sm text-slate-600 outline-none">
                    <input v-model="newExpense.name" type="text" placeholder="項目名稱" class="w-full bg-slate-50 rounded-xl p-3 text-sm outline-none">
                    <input v-model.number="newExpense.amount" type="number" placeholder="金額 (THB)" class="w-full bg-slate-50 rounded-xl p-3 text-sm outline-none">
                    <div class="grid grid-cols-2 gap-3">
                        <select v-model="newExpense.category" class="bg-slate-50 rounded-xl p-3 text-sm text-slate-600 outline-none">
                            <option value="food">飲食</option>
                            <option value="shopping">購物</option>
                            <option value="transport">交通</option>
                            <option value="stay">住宿</option>
                            <option value="ticket">門票</option>
                            <option value="other">其他</option>
                        </select>
                        <select v-model="newExpense.payment" class="bg-slate-50 rounded-xl p-3 text-sm text-slate-600 outline-none">
                            <option value="cash">現金</option>
                            <option value="card">信用卡</option>
                        </select>
                    </div>
                </div>
                <div class="flex space-x-3 mt-6">
                    <button @click="showExpenseModal = false" class="flex-1 py-3 rounded-xl bg-slate-100 text-slate-500 font-bold text-sm">取消</button>
                    <button @click="addExpense" class="flex-1 py-3 rounded-xl bg-deep-sea-blue text-white font-bold text-sm shadow-lg shadow-deep-sea-blue/30">儲存</button>
                </div>
            </div>
        </div>

        <div v-if="showItineraryModal" class="fixed inset-0 bg-deep-sea-blue/40 z-50 flex items-center justify-center p-6 backdrop-blur-sm animate-fade-in">
            <div class="bg-white rounded-3xl w-full max-w-sm p-6 shadow-2xl max-h-[90vh] overflow-y-auto">
                <h3 class="font-bold text-lg mb-5 text-center text-slate-800">{{ isEditMode ? '編輯行程' : '新增行程' }}</h3>
                <div class="space-y-3">
                    <select v-model="newItinerary.category" class="w-full bg-slate-50 rounded-xl p-3 text-sm outline-none">
                        <option value="sightseeing">景點</option>
                        <option value="food">飲食</option>
                        <option value="shopping">購物</option>
                        <option value="accommodation">住宿</option>
                        <option value="transport">交通</option>
                        <option value="ticket">門票</option>
                        <option value="flight">航班</option>
                        <option value="other">其他</option>
                    </select>
                    <input v-model="newItinerary.startTime" type="text" placeholder="時間 (例如 09:30)" class="w-full bg-slate-50 rounded-xl p-3 text-sm outline-none">
                    <input v-model="newItinerary.name" type="text" placeholder="行程名稱" class="w-full bg-slate-50 rounded-xl p-3 text-sm outline-none">
                    <input v-model="newItinerary.address" type="text" placeholder="地址/位置 (供導航用)" class="w-full bg-slate-50 rounded-xl p-3 text-sm outline-none">
                    <textarea v-model="newItinerary.note" rows="3" placeholder="備註 (選填)" class="w-full bg-slate-50 rounded-xl p-3 text-sm outline-none"></textarea>
                    
                    <div class="grid grid-cols-2 gap-3">
                        <input v-model="newItinerary.hours" type="text" placeholder="營業時間" class="bg-slate-50 rounded-xl p-3 text-sm outline-none">
                        <input v-model="newItinerary.price" type="text" placeholder="預算/門票" class="bg-slate-50 rounded-xl p-3 text-sm outline-none">
                    </div>
                </div>
                
                <div class="flex space-x-3 mt-6">
                    <button @click="showItineraryModal = false; isEditMode = false" :class="isEditMode ? 'w-1/3' : 'flex-1'" class="py-3 rounded-xl bg-slate-100 text-slate-500 font-bold text-sm">取消</button>
                    <button v-if="isEditMode" @click="removeItineraryItem(newItinerary.id)" class="w-1/3 py-3 rounded-xl bg-red-100 text-red-600 font-bold text-sm hover:bg-red-200 transition-colors">
                        <i class="fa-solid fa-trash-can mr-1"></i> 刪除
                    </button>
                    <button @click="saveItineraryItem" :class="isEditMode ? 'w-1/3' : 'flex-1'" class="py-3 rounded-xl bg-deep-sea-blue text-white font-bold text-sm shadow-lg shadow-deep-sea-blue/30">{{ isEditMode ? '儲存' : '新增' }}</button>
                </div>
            </div>
        </div>
    </div>

    <script>
        const { createApp, ref, computed } = Vue

        createApp({
            setup() {
                // 常數與設定
                const EXCHANGE_RATE = 0.92; // THB to TWD

                // UI 狀態
                const currentTab = ref('itinerary');
                const selectedDateIndex = ref(0);
                const showShoppingModal = ref(false);
                const showExpenseModal = ref(false);
                const showItineraryModal = ref(false);
                const isEditMode = ref(false);
                const currencyInput = ref(100);
                const currencyResult = ref(Math.round(100 * EXCHANGE_RATE));

                // 日期資料 (更新為 1/16 - 1/20, 移除 hasCar)
                const dates = ref([
                    { date: '1/16', weekday: '四', hasCar: false },
                    { date: '1/17', weekday: '五', hasCar: false },
                    { date: '1/18', weekday: '六', hasCar: false },
                    { date: '1/19', weekday: '日', hasCar: false },
                    { date: '1/20', weekday: '一', hasCar: false },
                ]);

                // 天氣資料 (模擬熱帶氣候)
                const weatherData = ref([
                    { condition: 'sunny', temp: '32/24', feel: '35' },
                    { condition: 'cloudy', temp: '31/25', feel: '34' },
                    { condition: 'sunny', temp: '33/24', feel: '36' },
                    { condition: 'rain', temp: '30/24', feel: '32' },
                    { condition: 'sunny', temp: '32/25', feel: '35' },
                ]);

                // 行程資料 (預設結構，可自行填入曼谷行程)
                const itineraryData = ref([
                    // Day 1
                    [
                        { id: 101, name: '抵達曼谷 BKK 機場', category: 'flight', startTime: '13:05', transportType: 'car', travelTime: '45m', note: '入境審查、領取行李、換匯', address: 'Suvarnabhumi Airport' },
                        { id: 102, name: '飯店 Check-in', category: 'accommodation', startTime: '15:00', transportType: 'walk', travelTime: '', note: '休息一下', address: '曼谷市區飯店' },
                        { id: 103, name: '晚餐: 泰式料理', category: 'food', startTime: '18:00', transportType: 'walk', travelTime: '10m', note: '冬蔭功、打拋豬', address: '' }
                    ],
                    // Day 2
                    [{ id: 201, name: '大皇宮 & 玉佛寺', category: 'sightseeing', startTime: '09:00', note: '穿著需端莊', address: 'The Grand Palace' }],
                    // Day 3
                    [{ id: 301, name: '恰圖恰週末市集', category: 'shopping', startTime: '10:00', note: '只有週末營業', address: 'Chatuchak Weekend Market' }],
                    // Day 4
                    [{ id: 401, name: '鄭王廟 (黎明寺)', category: 'sightseeing', startTime: '16:00', note: '看夕陽', address: 'Wat Arun' }],
                    // Day 5
                    [{ id: 501, name: '前往機場', category: 'transport', startTime: '11:00', note: 'CI0832 14:05 起飛', address: 'Suvarnabhumi Airport' }]
                ]);

                // 住宿資料
                const hotels = ref([
                    { name: '曼谷市區飯店 (範例)', date: '1/16 - 1/20 (4晚)', phone: '+66-2-123-4567', address: 'Bangkok, Thailand' }
                ]);

                // 購物與花費
                const shoppingList = ref([
                    { name: '泰式奶茶包', checked: false },
                    { name: 'Pocky 芒果口味', checked: false }
                ]);

                const expenses = ref([
                    { name: '機票', amount: 12000, category: 'flight', date: '2025-10-15', payment: 'card' },
                    { name: '預付住宿', amount: 8000, category: 'stay', date: '2025-11-20', payment: 'card' }
                ]);

                // 表單模型
                const newShoppingItem = ref({ name: '', checked: false });
                const newExpense = ref({ name: '', amount: null, category: 'food', date: '2026-01-16', payment: 'cash' });
                const newItinerary = ref({ id: null, category: 'sightseeing', name: '', startTime: '', address: '', note: '', hours: '', price: '', transportType: 'car', isNoteExpanded: false });

                // Computed
                const currentItinerary = computed(() => {
                    if (!itineraryData.value[selectedDateIndex.value]) {
                        itineraryData.value[selectedDateIndex.value] = [];
                    }
                    return itineraryData.value[selectedDateIndex.value];
                });

                const totalExpensesJPY = computed(() => expenses.value.reduce((sum, item) => sum + item.amount, 0));
                const totalExpensesTWD = computed(() => Math.round(totalExpensesJPY.value * EXCHANGE_RATE));

                // Methods - Helpers
                const CATEGORY_MAP = {
                    sightseeing: { color: '#FF7043', icon: 'fa-solid fa-camera' },
                    food: { color: '#FFA726', icon: 'fa-solid fa-utensils' },
                    shopping: { color: '#EC407A', icon: 'fa-solid fa-bag-shopping' },
                    accommodation: { color: '#5C6BC0', icon: 'fa-solid fa-bed' },
                    transport: { color: '#78909C', icon: 'fa-solid fa-van-shuttle' },
                    ticket: { color: '#8D6E63', icon: 'fa-solid fa-ticket' },
                    flight: { color: '#29B6F6', icon: 'fa-solid fa-plane' },
                    other: { color: '#BDBDBD', icon: 'fa-solid fa-circle-dot' }
                };

                const getCategoryColor = (cat) => CATEGORY_MAP[cat]?.color || CATEGORY_MAP.other.color;
                const getCategoryIcon = (cat) => CATEGORY_MAP[cat]?.icon || CATEGORY_MAP.other.icon;
                
                const getWeatherIcon = (cond) => {
                    const map = {
                        sunny: 'fa-solid fa-sun',
                        cloudy: 'fa-solid fa-cloud-sun',
                        rain: 'fa-solid fa-cloud-showers-heavy',
                        snow: 'fa-regular fa-snowflake'
                    };
                    return map[cond] || 'fa-solid fa-sun';
                };

                const getWeatherDescription = (cond) => {
                    const map = { sunny: '晴朗炎熱', cloudy: '多雲偶晴', rain: '午後雷陣雨', snow: '下雪' };
                    return map[cond] || '晴朗';
                };

                const getTransportIcon = (type) => {
                    const map = { car: 'fa-solid fa-car', walk: 'fa-solid fa-person-walking', public: 'fa-solid fa-train-subway' };
                    return map[type] || 'fa-solid fa-arrow-right';
                };

                const formatNumber = (num) => num ? num.toString().replace(/\B(?=(\d{3})+(?!\d))/g, ",") : '0';

                const calculateCurrency = () => {
                    currencyResult.value = Math.round(currencyInput.value * EXCHANGE_RATE);
                };

                // Methods - Actions
                const handleAddClick = () => {
                    if (currentTab.value === 'shopping') showShoppingModal.value = true;
                    else if (currentTab.value === 'expenses') showExpenseModal.value = true;
                    else {
                        isEditMode.value = false;
                        newItinerary.value = { id: Date.now(), category: 'sightseeing', name: '', startTime: '', address: '', note: '', hours: '', price: '', transportType: 'car', isNoteExpanded: false };
                        showItineraryModal.value = true;
                    }
                };

                const addShoppingItem = () => {
                    if (newShoppingItem.value.name) {
                        shoppingList.value.push({ ...newShoppingItem.value });
                        newShoppingItem.value.name = '';
                        showShoppingModal.value = false;
                    }
                };
                const removeShoppingItem = (idx) => shoppingList.value.splice(idx, 1);

                const addExpense = () => {
                    if (newExpense.value.name && newExpense.value.amount) {
                        expenses.value.push({ ...newExpense.value });
                        newExpense.value = { name: '', amount: null, category: 'food', date: '2026-01-16', payment: 'cash' };
                        showExpenseModal.value = false;
                    }
                };

                const editItem = (item) => {
                    isEditMode.value = true;
                    newItinerary.value = JSON.parse(JSON.stringify(item));
                    showItineraryModal.value = true;
                };

                const saveItineraryItem = () => {
                    if (!newItinerary.value.name) return alert('請輸入名稱');
                    const list = currentItinerary.value;
                    if (isEditMode.value) {
                        const idx = list.findIndex(i => i.id === newItinerary.value.id);
                        if (idx !== -1) list[idx] = { ...newItinerary.value };
                    } else {
                        list.push({ ...newItinerary.value });
                    }
                    showItineraryModal.value = false;
                };

                const removeItineraryItem = (id) => {
                    const idx = currentItinerary.value.findIndex(i => i.id === id);
                    if (idx !== -1) currentItinerary.value.splice(idx, 1);
                    showItineraryModal.value = false;
                };

                const moveItinerary = (id, direction) => {
                    const list = currentItinerary.value;
                    const idx = list.findIndex(i => i.id === id);
                    if (idx === -1) return;
                    const newIdx = idx + direction;
                    if (newIdx >= 0 && newIdx < list.length) {
                        const item = list.splice(idx, 1)[0];
                        list.splice(newIdx, 0, item);
                    }
                };

                const openMap = (q) => {
                    if(q) window.open(`https://www.google.com/maps/search/?api=1&query=${encodeURIComponent(q)}`, '_blank');
                };

                const openMapDirections = (start, end) => {
                    const o = start.address || start.name;
                    const d = end.address || end.name;
                    if(o && d) window.open(`https://www.google.com/maps/dir/?api=1&origin=${encodeURIComponent(o)}&destination=${encodeURIComponent(d)}`, '_blank');
                };

                return {
                    currentTab, selectedDateIndex, dates, weatherData, currentItinerary, hotels,
                    shoppingList, expenses, totalExpensesJPY, totalExpensesTWD,
                    showShoppingModal, showExpenseModal, showItineraryModal, isEditMode,
                    currencyInput, currencyResult, newShoppingItem, newExpense, newItinerary,
                    calculateCurrency, formatNumber, getCategoryColor, getCategoryIcon, getWeatherIcon, getWeatherDescription, getTransportIcon,
                    handleAddClick, addShoppingItem, removeShoppingItem, addExpense,
                    editItem, saveItineraryItem, removeItineraryItem, moveItinerary, openMap, openMapDirections
                };
            }
        }).mount('#app');
    </script>
</body>
</html>
