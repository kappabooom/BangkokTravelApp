<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport"
          content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>2026曼谷旅行</title>

    <!-- Apple Touch Icon -->
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <link rel="apple-touch-icon" href="apple-touch-icon.png">
    <link rel="icon" type="image/png" href="apple-touch-icon.png">

    <!-- UI -->
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet"
          href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        'snow-white': '#FFFDE7',
                        'ice-blue': '#4DB6AC',
                        'light-snow-blue': '#FFF3E0',
                        'deep-sea-blue': '#E65100',
                        'accent-yellow': '#FFB300',
                        'soft-gray': '#FAFAFA'
                    }
                }
            }
        }
    </script>

    <style>
        @import url('https://fonts.googleapis.com/css?family=Noto+Sans+TC:wght@300;400;500;700&display=swap');
        body {
            background-color: #FFF3E0;
            -webkit-tap-highlight-color: transparent;
            font-family: 'Noto Sans TC', sans-serif;
            color: #334155;
        }
        .app-container {
            max-width: 480px;
            margin: 0 auto;
            min-height: 100vh;
            background-color: #ffffff;
            box-shadow: 0 0 30px rgba(0, 0, 0, 0.05);
            position: relative;
            padding-bottom: 90px;
        }

        .login-screen {
            position: fixed;
            inset: 0;
            z-index: 60;
            background: linear-gradient(135deg, #FFF3E0 0%, #FFE0B2 100%);
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
        }

        .header-bg {
            background-color: #ffffff;
            padding: 0;
            position: relative;
            overflow: hidden;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.15);
            border-bottom-left-radius: 35px;
            border-bottom-right-radius: 35px;
            z-index: 10;
        }
        .header-image-container {
            width: 100%;
            height: 250px;
            overflow: hidden;
            background-color: transparent;
            border-bottom-left-radius: 35px;
            border-bottom-right-radius: 35px;
        }
        .header-image-container img {
            width: 100%;
            height: 100%;
            object-fit: cover;
            display: block;
        }
        .side-tab-bar {
            position: absolute;
            bottom: 15px;
            right: 16px;
            z-index: 30;
            display: flex;
            flex-direction: row;
            gap: 8px;
        }
        .tab-button {
            width: 40px;
            height: 40px;
            border-radius: 9999px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.125rem;
            box-shadow: 0 4px 10px rgba(0,0,0,0.15);
            transition: all 0.2s ease;
            border: none;
            cursor: pointer;
        }
        .tab-button.active {
            background-color: #E65100;
            color: #ffffff;
            box-shadow: 0 6px 15px rgba(230, 81, 0, 0.4);
            transform: scale(1.05);
        }
        .tab-button:not(.active) {
            background-color: #ffffff;
            color: #4DB6AC;
        }
        .app-main {
            padding-top: 25px !important;
            position: relative;
            z-index: 5;
        }
        .hide-scrollbar::-webkit-scrollbar { display: none; }
        .hide-scrollbar { -ms-overflow-style: none; scrollbar-width: none; }
        .card-shadow {
            box-shadow: 0 4px 20px rgba(230, 81, 0, 0.1);
            transition: transform 0.2s ease, box-shadow 0.2s ease;
        }
        .animate-fade-in { animation: fadeIn 0.4s ease-out; }
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .fab-shadow { box-shadow: 0 4px 15px rgba(255, 179, 0, 0.5); }
        .note-content { max-height: 2.5rem; overflow: hidden; transition: max-height 0.3s ease-out; }
        .note-content.expanded { max-height: 500px; }
        .expenses-banner { background: linear-gradient(135deg, #FF7043 0%, #AB47BC 100%); }
        .date-selector-sticky {
            background-color: #ffffff;
            border-bottom: 1px solid #f0f0f0;
            z-index: 20;
            top: 0;
            padding-top: env(safe-area-inset-top, 20px);
        }
        .rotate-180 { transform: rotate(180deg); }
        .custom-select-wrapper { position: relative; }
        .custom-select-wrapper select {
            -webkit-appearance: none;
            appearance: none;
            width: 100%;
            height: 100%;
            opacity: 0;
            position: absolute;
            left: 0;
            top: 0;
            cursor: pointer;
            z-index: 10;
        }
        .pulse-arrow { animation: pulse-x 1.5s infinite ease-in-out; }
        @keyframes pulse-x {
            0%,100% { transform: translateX(0); opacity: 0.8; }
            50% { transform: translateX(5px); opacity: 1; }
        }

        .flip-list-move { transition: transform 0.5s cubic-bezier(0.2, 0, 0, 1); z-index: 20; position: relative; }
        .flip-list-enter-active, .flip-list-leave-active { transition: all 0.3s cubic-bezier(0.2, 0, 0, 1); }
        .flip-list-enter-from, .flip-list-leave-to { opacity: 0; transform: scale(0.95); }
        .highlight-bg { animation: highlight 1s ease-out forwards; }
        @keyframes highlight {
            0% {
                background-color: #FFF8E1;
                transform: scale(1.02);
                box-shadow: 0 10px 15px -3px rgba(0,0,0,0.1);
            }
            100% {
                background-color: #ffffff;
                transform: scale(1);
                box-shadow: 0 4px 20px rgba(230,81,0,0.1);
            }
        }

        .loader-container {
            position: fixed;
            inset: 0;
            z-index: 9999;
            background-color: #FFF3E0;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            transition: opacity 0.5s ease, visibility 0.5s ease;
        }
        .loader-container.hidden { opacity: 0; visibility: hidden; pointer-events: none; }
        .spinner {
            width: 50px;
            height: 50px;
            border: 4px solid rgba(230,81,0,0.2);
            border-top-color: #E65100;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin-bottom: 1rem;
        }
        .loader-logo {
            font-size: 3rem;
            color: #E65100;
            margin-bottom: 1rem;
            animation: pulse-logo 1.5s infinite ease-in-out;
        }
        @keyframes spin { to { transform: rotate(360deg); } }
        @keyframes pulse-logo {
            0%,100% { transform: scale(1); opacity: 1; }
            50% { transform: scale(1.1); opacity: 0.8; }
        }
    </style>
</head>
<body>
<div id="loading-screen" class="loader-container">
    <i class="fa-solid fa-plane-departure loader-logo"></i>
    <div class="spinner"></div>
    <p class="text-deep-sea-blue font-bold tracking-widest text-sm">Loading...</p>
</div>

<div id="app" class="app-container">
    <!-- 登入 -->
    <div v-if="!hasSelectedUser" class="login-screen animate-fade-in p-6">
        <div class="text-center mb-8">
            <div class="w-24 h-24 bg-white rounded-full mx-auto shadow-lg flex items-center justify-center mb-4">
                <i class="fa-solid fa-plane-up text-4xl text-deep-sea-blue"></i>
            </div>
            <h1 class="text-2xl font-bold text-slate-800 mb-1">歡迎回來</h1>
            <p class="text-sm text-slate-500">請選擇您的成員身份以登入</p>
        </div>

        <div v-if="members.length === 0" class="flex flex-col items-center">
            <div class="spinner w-8 h-8 border-2"></div>
            <span class="text-xs text-slate-400">正在讀取成員...</span>
        </div>

        <div v-else class="grid grid-cols-2 gap-4 w-full max-w-sm">
            <div v-for="member in members" :key="member.id"
                 @click="attemptLogin(member)"
                 class="bg-white p-4 rounded-2xl shadow-sm border border-orange-100 flex flex-col items-center justify-center cursor-pointer hover:shadow-md hover:scale-105 transition-all relative overflow-hidden group">
                <div class="absolute top-0 right-0 p-2" v-if="member.role === 'admin' || member.password">
                    <i v-if="member.role === 'admin'"
                       class="fa-solid fa-crown text-[10px] text-yellow-500 bg-yellow-100 p-1 rounded-full"></i>
                    <i v-else-if="member.password"
                       class="fa-solid fa-lock text-[10px] text-slate-400 bg-slate-100 p-1 rounded-full"></i>
                </div>

                <div class="w-12 h-12 rounded-full mb-2 flex items-center justify-center text-lg font-bold text-white shadow-inner"
                     :class="member.role === 'admin'
                             ? 'bg-gradient-to-br from-orange-400 to-deep-sea-blue'
                             : 'bg-gradient-to-br from-ice-blue to-teal-500'">
                    {{ member.name.substring(0,1).toUpperCase() }}
                </div>
                <span class="font-bold text-slate-700 text-sm truncate w-full text-center">{{ member.name }}</span>
            </div>
        </div>
    </div>

    <!-- 主畫面 -->
    <div v-else>
        <div class="header-bg relative">
            <div class="header-image-container">
                <img src="banner.png" alt="曼谷家族旅行計畫"
                     onerror="this.src='https://images.unsplash.com/photo-1596422846543-e1275c6fc197?auto=format&fit=crop&w=800&q=80'">
            </div>
            <div class="side-tab-bar">
                <button @click="currentTab = 'itinerary'" title="行程"
                        :class="{'active': currentTab === 'itinerary'}" class="tab-button">
                    <i class="fa-solid fa-map-location-dot"></i>
                </button>
                <button @click="currentTab = 'info'" title="資訊"
                        :class="{'active': currentTab === 'info'}" class="tab-button">
                    <i class="fa-solid fa-circle-info"></i>
                </button>
                <button @click="currentTab = 'shopping'" title="購物"
                        :class="{'active': currentTab === 'shopping'}" class="tab-button">
                    <i class="fa-solid fa-basket-shopping"></i>
                </button>
                <button @click="currentTab = 'expenses'" title="花費"
                        :class="{'active': currentTab === 'expenses'}" class="tab-button">
                    <i class="fa-solid fa-coins"></i>
                </button>
            </div>
        </div>

        <main class="p-4 app-main">
            <!-- 行程 Tab（原本內容不變） -->
            <!-- ... 這段保持你上一版的行程畫面、卡片、Modal 等程式，不修改 ... -->

            <!-- 資訊 Tab（只在 Vue setup 裡換 hotels） -->
            <!-- 購物 / 花費 / 成員管理 / 密碼 Modal 也保持你原本的程式碼結構 -->
        </main>

        <!-- 密碼 Modal -->
        <!-- ... 保持原本寫法 ... -->
    </div>
</div>

<script type="module">
    import { createApp, ref, computed, onMounted, nextTick } from 'https://unpkg.com/vue@3/dist/vue.esm-browser.js';
    import { initializeApp } from "https://www.gstatic.com/firebasejs/12.6.0/firebase-app.js";
    import {
        getFirestore, collection, addDoc, doc,
        updateDoc, deleteDoc, onSnapshot, writeBatch, getDocs
    } from "https://www.gstatic.com/firebasejs/12.6.0/firebase-firestore.js";

    const firebaseConfig = {
        apiKey: "AIzaSyCyYCSGWQ0Wdf13AE62UG7W8WiwpqCHs_0",
        authDomain: "bankoktrip2026.firebaseapp.com",
        projectId: "bankoktrip2026",
        storageBucket: "bankoktrip2026.firebasestorage.app",
        messagingSenderId: "347622663908",
        appId: "1:347622663908:web:6a514d1761f215a2ae6ef1",
        measurementId: "G-ENHVD5XKF8"
    };

    const firebaseApp = initializeApp(firebaseConfig);
    const db = getFirestore(firebaseApp);

    /* === 這裡是你要的新預設行程，已依照最新 Day1–Day5 規劃整理好 === */
    const INITIAL_ITINERARY = [
        // Day 1（週五）1/16 抵達＋Craftsman＋Ari＋Lay Lao
        [
            {
                category: 'transport',
                name: '抵達曼谷機場 (BKK / DMK)',
                startTime: '13:05',
                note: '下機、通關、領行李，約 60 分鐘。',
                order: 1,
                transportType: 'flight',
                travelTime: ''
            },
            {
                category: 'transport',
                name: '機場 → Craftsman Bangkok',
                startTime: '14:15',
                address: 'Craftsman Bangkok, 34-36 Phahon Yothin 11, Samsen Nai, Phaya Thai, Bangkok 10400',
                note: '建議預約一台保母車（或 2 台 Grab），車程約 30–40 分鐘。',
                order: 2,
                transportType: 'car',
                travelTime: '約 30–40 分'
            },
            {
                category: 'accommodation',
                name: 'Craftsman Hotel 入住 & 休息',
                startTime: '15:00',
                address: 'Craftsman Bangkok, Phahon Yothin 11',
                note: '放行李、沖澡、泳池放空。',
                order: 3,
                transportType: 'walk',
                travelTime: '飯店內活動'
            },
            {
                category: 'food',
                name: 'Ari 咖啡街散步',
                startTime: '16:00',
                address: 'Ari BTS Station, Phaya Thai, Bangkok',
                note: '從飯店叫車到 Ari 一帶（約 10 分鐘）。推薦：Nana Coffee Roasters Ari、Gump’s Ari 等文青咖啡店。',
                order: 4,
                transportType: 'car',
                travelTime: '約 10 分'
            },
            {
                category: 'food',
                name: '晚餐：Lay Lao – Ari',
                startTime: '18:30',
                address: 'Lay Lao - Ari, 65 Phahon Yothin 7, Samsen Nai, Phaya Thai, Bangkok 10400',
                note: '米其林必比登推薦的東北泰菜＋海鮮，很適合 8 人分食，需事先訂位。',
                order: 5,
                transportType: 'walk',
                travelTime: 'Ari 區步行約 5–10 分'
            },
            {
                category: 'other',
                name: '按摩 / 飯店泳池 / 大麻店',
                startTime: '20:30',
                address: 'Calm Spa Ari / High Got You Dispensary / Craftsman Bangkok',
                note: '視大家精神：按摩、回飯店泳池、小酌或去 Ari 一帶 Dispensary。',
                order: 6,
                transportType: 'car',
                travelTime: '短程車或步行'
            }
        ],
        // Day 2（週六）1/17 臥佛寺・鄭王廟・ICONSIAM・Asiatique・Nana
        [
            {
                category: 'food',
                name: '早餐：FRAN’S ARI',
                startTime: '08:30',
                address: "FRAN'S ARI, 24 Ari 4 Fang Nua Alley, Samsen Nai, Phaya Thai, Bangkok 10400",
                note: '從飯店叫車約 10 分鐘。早午餐份量大，建議 8 人先訂位避免排隊。',
                order: 1,
                transportType: 'car',
                travelTime: '約 10 分'
            },
            {
                category: 'transport',
                name: '前往臥佛寺 (Wat Pho)',
                startTime: '10:00',
                address: 'Wat Phra Chetuphon (Wat Pho), 2 Sanam Chai Rd, Phra Nakhon, Bangkok',
                note: '叫 2 台車直達河邊，車程約 20–30 分鐘（視塞車而定）。',
                order: 2,
                transportType: 'car',
                travelTime: '約 20–30 分'
            },
            {
                category: 'sightseeing',
                name: '臥佛寺 (Wat Pho)',
                startTime: '10:30',
                address: 'Wat Phra Chetuphon (Wat Pho), Sanam Chai Rd',
                note: '參觀大臥佛與佛塔區，抓 1.5 小時含拍照與步行。',
                order: 3,
                transportType: 'walk',
                travelTime: '園區步行'
            },
            {
                category: 'transport',
                name: '步行至 RONGROS',
                startTime: '12:00',
                address: 'RONGROS, 392/16 Maha Rat Rd, Phra Nakhon, Bangkok 10200',
                note: '沿河畔步行約 5–10 分鐘。',
                order: 4,
                transportType: 'walk',
                travelTime: '約 5–10 分'
            },
            {
                category: 'food',
                name: '午餐：RONGROS',
                startTime: '12:15',
                address: 'RONGROS, 392/16 Maha Rat Rd, Phra Nakhon, Bangkok 10200',
                note: '河邊景觀泰菜，窗邊座位可直接看到鄭王廟，8 人強烈建議預約。',
                order: 5,
                transportType: 'walk',
                travelTime: ''
            },
            {
                category: 'transport',
                name: '步行至 Tha Tien 碼頭',
                startTime: '13:45',
                address: 'Tha Tien Pier, Maharaj Rd, Phra Nakhon, Bangkok',
                note: '從餐廳走回 Tha Tien 碼頭，約 5–10 分鐘。',
                order: 6,
                transportType: 'walk',
                travelTime: '約 5–10 分'
            },
            {
                category: 'sightseeing',
                name: '鄭王廟 (Wat Arun)',
                startTime: '14:00',
                address: 'Wat Arun Ratchawararam, Thon Buri, Bangkok',
                note: '搭短程渡輪過河約 5 分鐘。停留 1–1.5 小時，爬主塔拍照，注意防曬。',
                order: 7,
                transportType: 'public',
                travelTime: '渡輪約 5 分'
            },
            {
                category: 'transport',
                name: 'Wat Arun 碼頭 → ICONSIAM',
                startTime: '15:30',
                address: 'ICONSIAM, 299 Charoen Nakhon Rd, Khlong San',
                note: '從河岸搭船前往 ICONSIAM，船程約 20–30 分鐘（含等船）。',
                order: 8,
                transportType: 'public',
                travelTime: '約 20–30 分'
            },
            {
                category: 'shopping',
                name: 'ICONSIAM 逛街',
                startTime: '16:00',
                address: 'ICONSIAM, 299 Charoen Nakhon Rd, Khlong San, Bangkok',
                note: '逛 SookSiam 室內水上市場、超市、伴手禮，中途可補點心飲料。',
                order: 9,
                transportType: 'walk',
                travelTime: ''
            },
            {
                category: 'transport',
                name: 'ICONSIAM → Sathorn Pier → Asiatique',
                startTime: '18:30',
                address: 'Sathorn Pier / Asiatique The Riverfront',
                note: '搭 ICONSIAM 船到 Sathorn Pier 再轉 Asiatique 接駁船。',
                order: 10,
                transportType: 'public',
                travelTime: '約 30 分（含轉船）'
            },
            {
                category: 'sightseeing',
                name: '碼頭夜市 Asiatique（Skyflyer＋晚餐）',
                startTime: '19:00',
                address: 'Asiatique The Riverfront, Charoen Krung Rd, Bangkok',
                note: '購買 Skyflyer 摩天輪票，邊逛邊吃；晚餐在夜市內找 8 人大桌餐廳或多人合點。',
                order: 11,
                transportType: 'walk',
                travelTime: ''
            },
            {
                category: 'transport',
                name: 'Asiatique → Nana 區',
                startTime: '21:00',
                address: 'Nana Plaza, Sukhumvit Soi 4, Bangkok',
                note: '8 人拆兩車，車程約 20–30 分；約好回程與集合地點。',
                order: 12,
                transportType: 'car',
                travelTime: '約 20–30 分'
            },
            {
                category: 'other',
                name: 'Nana 廣場 夜生活',
                startTime: '21:30',
                address: 'Nana Plaza, Sukhumvit Soi 4, Bangkok',
                note: '自由活動，結束後直接叫車回 Craftsman Bangkok。',
                order: 13,
                transportType: 'car',
                travelTime: '回飯店約 20–30 分'
            }
        ],
        // Day 3（週日）1/18 美功・安帕瓦・通羅 Airbnb・頌通・Tichuca
        [
            {
                category: 'transport',
                name: '從 Craftsman 出發（包車 / 保母車）',
                startTime: '08:30',
                address: 'Craftsman Bangkok, Phaya Thai',
                note: '包車含行李，建議預約 10–12 小時，方便郊區一日遊。',
                order: 1,
                transportType: 'car',
                travelTime: ''
            },
            {
                category: 'transport',
                name: '曼谷 → 美功鐵道市集',
                startTime: '08:30',
                address: 'Maeklong Railway Market, Mae Klong, Samut Songkhram',
                note: '車程約 2 小時，預計 10:30 抵達。',
                order: 2,
                transportType: 'car',
                travelTime: '約 2 小時'
            },
            {
                category: 'sightseeing',
                name: '美功鐵道市集',
                startTime: '10:30',
                address: 'Maeklong Railway Market, Mae Klong',
                note: '對準約 11:10 抵達或 11:30 發車的火車，拍「火車穿過市場」。午餐：廣銘珍雲吞麵或鐵軌邊媽媽桑泡麵。',
                order: 3,
                transportType: 'walk',
                travelTime: ''
            },
            {
                category: 'transport',
                name: '美功 → 安帕瓦水上市場',
                startTime: '11:45',
                address: 'Amphawa Floating Market, Amphawa District, Samut Songkhram 75110',
                note: '車程約 30–45 分鐘。',
                order: 4,
                transportType: 'car',
                travelTime: '約 30–45 分'
            },
            {
                category: 'sightseeing',
                name: '安帕瓦水上市場',
                startTime: '12:30',
                address: 'Amphawa Floating Market, Amphawa',
                note: '週五–週日 14:00–21:00 開市，下午先吃先逛、傍晚最熱鬧，可安排約 1 小時船遊（河岸寺廟／季節可看螢火蟲）。',
                order: 5,
                transportType: 'walk',
                travelTime: ''
            },
            {
                category: 'transport',
                name: '安帕瓦 → 曼谷通羅 Airbnb',
                startTime: '16:00',
                address: 'Thonglor, Sukhumvit 55, Watthana, Bangkok',
                note: '車程約 1.5 小時，回曼谷通羅入住。',
                order: 6,
                transportType: 'car',
                travelTime: '約 1.5 小時'
            },
            {
                category: 'accommodation',
                name: '通羅 Airbnb Check-in & 休息',
                startTime: '17:30',
                address: 'Thonglor Airbnb, Sukhumvit 55, Bangkok',
                note: '放行李、稍作休息。',
                order: 7,
                transportType: 'walk',
                travelTime: ''
            },
            {
                category: 'transport',
                name: '通羅 → 頌通酒家 (Sornthong Pochana)',
                startTime: '18:30',
                address: 'Sornthong Pochana, 2829-31 Rama IV Rd, Khlong Toei, Bangkok',
                note: '車程約 20–30 分鐘，建議叫車前往。',
                order: 8,
                transportType: 'car',
                travelTime: '約 20–30 分'
            },
            {
                category: 'food',
                name: '晚餐：頌通酒家 Sornthong Pochana',
                startTime: '19:00',
                address: 'Sornthong Pochana, 2829-31 Rama IV Rd, Khlong Toei, Bangkok',
                note: '老字號海鮮泰菜，咖哩螃蟹、清蒸魚與各式海鮮很適合 8 人分食。',
                order: 9,
                transportType: 'walk',
                travelTime: ''
            },
            {
                category: 'transport',
                name: '前往 Tichuca Rooftop Bar',
                startTime: '20:30',
                address: 'Tichuca Rooftop Bar, T-One Building 46F, Soi Sukhumvit 40, Bangkok',
                note: '從頌通出發車程約 15–20 分鐘，建議提早排隊或先查詢是否可預約。',
                order: 10,
                transportType: 'car',
                travelTime: '約 15–20 分'
            },
            {
                category: 'other',
                name: '高空酒吧：Tichuca Rooftop Bar',
                startTime: '21:00',
                address: 'Tichuca Rooftop Bar, T-One Building, Sukhumvit 40, Bangkok',
                note: '喝完可回通羅一帶酒吧續攤或散步 / 叫車回 Airbnb。',
                order: 11,
                transportType: 'walk',
                travelTime: ''
            }
        ],
        // Day 4（週一）1/19 四面佛・Central World・Siam 區・按摩・Mungkorn・Big C
        [
            {
                category: 'transport',
                name: '通羅 → 四面佛 (Erawan Shrine)',
                startTime: '09:00',
                address: 'Erawan Shrine, Ratchadamri Rd, Bangkok',
                note: '可搭 BTS 或叫車，約 20–30 分鐘，建議避開上班尖峰。',
                order: 1,
                transportType: 'car',
                travelTime: '約 20–30 分'
            },
            {
                category: 'sightseeing',
                name: '四面佛 (Erawan Shrine)',
                startTime: '09:30',
                address: 'Erawan Shrine, Ratchadamri Rd, Bangkok',
                note: '早上人潮相對少，拜完可以直接走到百貨公司。',
                order: 2,
                transportType: 'walk',
                travelTime: '步行'
            },
            {
                category: 'shopping',
                name: 'Central World',
                startTime: '10:00',
                address: 'CentralWorld, 999/9 Rama I Rd, Pathum Wan, Bangkok',
                note: '百貨 10:00 開門，逛服飾、美妝、超市，人少好逛。',
                order: 3,
                transportType: 'walk',
                travelTime: '步行'
            },
            {
                category: 'transport',
                name: '步行 / BTS 前往 Siam Paragon',
                startTime: '11:30',
                address: 'Siam Paragon, 991 Rama I Rd, Pathum Wan, Bangkok',
                note: '可走 skywalk 或搭 BTS 一站抵達。',
                order: 4,
                transportType: 'public',
                travelTime: '約 10–15 分'
            },
            {
                category: 'food',
                name: '午餐：Here Hai @ Siam Paragon',
                startTime: '12:00',
                address: 'Here Hai, Gourmet Eats, G Floor, Siam Paragon, Bangkok',
                note: '分店在 Paragon G 樓美食街，吃蟹肉炒飯等招牌料理，避免本店久候。',
                order: 5,
                transportType: 'walk',
                travelTime: ''
            },
            {
                category: 'shopping',
                name: 'Siam 區自由活動',
                startTime: '13:30',
                address: 'Siam Paragon / Siam Center / Siam Discovery, Rama I Rd, Bangkok',
                note: '各自逛街、買東西約 3 小時，可分頭行動再約集合點。',
                order: 6,
                transportType: 'walk',
                travelTime: ''
            },
            {
                category: 'other',
                name: '按摩（Siam / Ratchadamri 一帶）',
                startTime: '16:30',
                address: 'Health Land / Let’s Relax (Siam / Ratchadamri)',
                note: '建議事先預約連鎖品牌，幫 8 人排連續時段。',
                order: 7,
                transportType: 'walk',
                travelTime: '依店家距離'
            },
            {
                category: 'transport',
                name: '市區 → Mungkorn Seafood @Sukhumvit',
                startTime: '18:00',
                address: 'Mungkorn Seafood Sukhumvit, 39 Soi Pridi Banomyong 5, Sukhumvit 71, Bangkok',
                note: '可搭 BTS 至 Phra Khanong 再轉車，或直接 Grab，約 20–30 分。',
                order: 8,
                transportType: 'car',
                travelTime: '約 20–30 分'
            },
            {
                category: 'food',
                name: '晚餐：Mungkorn Seafood @Sukhumvit',
                startTime: '18:30',
                address: 'Mungkorn Seafood Sukhumvit, Soi Pridi Banomyong 5, Sukhumvit 71, Bangkok',
                note: '以大頭蝦和海鮮吃到飽聞名，建議先訂位確保 8 人座位。',
                order: 9,
                transportType: 'walk',
                travelTime: ''
            },
            {
                category: 'transport',
                name: '前往 Big C Ekkamai',
                startTime: '20:30',
                address: 'Big C Ekkamai, Sukhumvit 63 (Ekkamai Rd), Bangkok',
                note: '從 Mungkorn 出發車程約 10–15 分鐘。',
                order: 10,
                transportType: 'car',
                travelTime: '約 10–15 分'
            },
            {
                category: 'shopping',
                name: 'Big C Ekkamai 採購',
                startTime: '21:00',
                address: 'Big C Ekkamai, Sukhumvit 63, Bangkok',
                note: '人少好逛，可集中買零食、調理包、伴手禮，之後回通羅 Airbnb。',
                order: 11,
                transportType: 'car',
                travelTime: '回通羅約 10–15 分'
            }
        ],
        // Day 5（週二）1/20 早餐・收行李・機場返台
        [
            {
                category: 'food',
                name: '早餐 & 打包行李',
                startTime: '08:30',
                address: 'Thonglor, Sukhumvit 55, Bangkok',
                note: '通羅附近咖啡店隨意早餐，回 Airbnb 收拾行李。',
                order: 1,
                transportType: 'walk',
                travelTime: ''
            },
            {
                category: 'accommodation',
                name: '通羅 Airbnb 退房',
                startTime: '10:30',
                address: 'Thonglor Airbnb, Sukhumvit 55, Bangkok',
                note: '確認護照、手機、錢包與所有行李已收好。',
                order: 2,
                transportType: 'walk',
                travelTime: ''
            },
            {
                category: 'transport',
                name: '通羅 → 機場 (BKK)',
                startTime: '10:30',
                address: 'Suvarnabhumi Airport (BKK), Bangkok',
                note: '建議預約保母車，抓約 45 分鐘車程，考慮塞車仍安全。',
                order: 3,
                transportType: 'car',
                travelTime: '約 45 分'
            },
            {
                category: 'other',
                name: '機場托運、通關、逛免稅 & 候機',
                startTime: '11:15',
                address: 'Suvarnabhumi Airport Departure Hall, Bangkok',
                note: '國際線一般建議起飛前 2–3 小時到機場，目前是約 2 小時 50 分鐘，算安全。',
                order: 4,
                transportType: 'walk',
                travelTime: ''
            },
            {
                category: 'flight',
                name: '14:05 起飛，返回台灣 (CI0832)',
                startTime: '14:05',
                address: 'Suvarnabhumi Airport Gate, Bangkok',
                note: '帶著戰利品返家。',
                order: 5,
                transportType: 'flight',
                travelTime: ''
            }
        ]
    ];

    const app = createApp({
        setup() {
            const TRIP_YEAR = 2026;
            const EXCHANGE_RATE = ref(0.92);
            const WEATHER_API_KEY = 'e5e727b85066927db1d248be29dfa632';

            const currentTab = ref('itinerary');
            const selectedDateIndex = ref(0);
            const showShoppingModal = ref(false);
            const showExpenseModal = ref(false);
            const showItineraryModal = ref(false);
            const showMemberModal = ref(false);
            const isEditMode = ref(false);
            const inputTHB = ref(100);
            const inputTWD = ref(92);
            const expandedMember = ref(null);
            const editingMemberId = ref(null);
            const tempMemberName = ref('');
            const editInput = ref(null);
            const recentlyMovedId = ref(null);
            const isRatesLoading = ref(false);

            const hasSelectedUser = ref(false);
            const currentUser = ref('');
            const pendingUser = ref('');
            const membersLoaded = ref(false);

            const isRoleEditMode = ref(false);
            const showRolePasswordModal = ref(false);
            const rolePasswordInput = ref('');
            const ROLE_PASSWORD = 'kappaho17';
            const roleEditUnlocked = ref(false);
            const passwordMode = ref('role');
            const targetLoginMember = ref(null);

            const dates = ref([
                { date: '1/16', weekday: '五', hasCar: false },
                { date: '1/17', weekday: '六', hasCar: false },
                { date: '1/18', weekday: '日', hasCar: true },
                { date: '1/19', weekday: '一', hasCar: false },
                { date: '1/20', weekday: '二', hasCar: false }
            ]);
            const weatherData = ref([]);
            const itineraryData = ref([[], [], [], [], []]);

            /* 住宿資訊更新 */
            const hotels = ref([
                {
                    name: 'Craftsman Bangkok',
                    date: '1/16 - 1/18 (2晚)',
                    phone: '+66 2 279 7299',
                    address: '34-36 Phahon Yothin 11, Samsen Nai, Phaya Thai, Bangkok 10400'
                },
                {
                    name: 'Thonglor Airbnb',
                    date: '1/18 - 1/20 (2晚)',
                    phone: 'Contact Host',
                    address: 'Sukhumvit 55 (Thonglor), Watthana, Bangkok'
                }
            ]);

            const DEFAULT_MEMBERS = ['kappabooom', 'beibei1029', 'hsiannnnng', 'shinbinwei', 'aylwen4444', 'wunsin', 'rtrtr1', 'blackblacknu'];
            const members = ref([]);
            const allShoppingList = ref([]);
            const expenses = ref([]);
            const newMemberName = ref('');
            const editingExpenseId = ref(null);
            const newShoppingItem = ref({ name: '', checked: false });
            const newItinerary = ref({});
            const newExpense = ref({});

            const collapsedSections = ref({
                expenses: false,
                split: true,
                transfer: true
            });

            const showToast = ref(false);
            const toastMessage = ref('');
            const triggerToast = (msg) => {
                toastMessage.value = msg;
                showToast.value = true;
                setTimeout(() => { showToast.value = false; }, 3000);
            };

            const currentUserRole = computed(() => {
                const m = members.value.find(m => m.name === currentUser.value);
                return m?.role || 'viewer';
            });
            const canEditItinerary = computed(() => currentUserRole.value === 'admin');

            const currentShoppingList = computed(() =>
                allShoppingList.value.filter(item => item.owner === currentUser.value)
            );

            /* === 以下：匯率、天氣、行程存取、支出 / 分帳 / 成員管理等
                 全部沿用你上一版的函式與寫法，不再展開，只修改用到 INITIAL_ITINERARY / hotels 的地方 === */

            const formatNumber = (num) =>
                num ? num.toString().replace(/\B(?=(\d{3})+(?!\d))/g, ",") : '0';

            onMounted(async () => {
                // expenses
                const expensesCol = collection(db, 'expenses');
                onSnapshot(expensesCol, (snapshot) => {
                    expenses.value = snapshot.docs.map(doc => ({ id: doc.id, ...doc.data() }));
                });

                // shopping
                onSnapshot(collection(db, 'shopping_list'), (snapshot) => {
                    allShoppingList.value = snapshot.docs.map(doc => ({ id: doc.id, ...doc.data() }));
                });

                // members
                const membersCol = collection(db, 'members');
                onSnapshot(membersCol, async (snapshot) => {
                    if (!snapshot.empty) {
                        members.value = snapshot.docs.map(doc => {
                            const data = doc.data();
                            return {
                                id: doc.id,
                                name: data.name,
                                active: data.active,
                                role: data.role || 'viewer',
                                password: data.password || ''
                            };
                        });
                        membersLoaded.value = true;
                    } else {
                        for (const name of DEFAULT_MEMBERS) {
                            await addDoc(membersCol, { name, active: true, role: 'viewer', password: '' });
                        }
                    }
                });

                // itinerary：用新的 INITIAL_ITINERARY 初始化
                for (let i = 0; i < dates.value.length; i++) {
                    const itineraryCol = collection(db, `itinerary_day_${i}`);
                    const snap = await getDocs(itineraryCol);
                    if (snap.empty && INITIAL_ITINERARY[i]) {
                        const batch = writeBatch(db);
                        INITIAL_ITINERARY[i].forEach(item => {
                            const newRef = doc(itineraryCol);
                            batch.set(newRef, item);
                        });
                        await batch.commit();
                    }

                    onSnapshot(itineraryCol, (snapshot) => {
                        const items = snapshot.docs.map(doc => ({
                            ...doc.data(),
                            id: doc.id,
                            isNoteExpanded: false,
                            order: doc.data().order ?? 9999
                        }));
                        itineraryData.value[i] = items;
                    });
                }

                await fetchExchangeRate();
                await fetchWeather();

                setTimeout(() => {
                    const loader = document.getElementById('loading-screen');
                    if (loader) loader.classList.add('hidden');
                }, 1500);
            });

            /* === 以下所有函式：fetchExchangeRate、fetchWeather、
                               handleAddClick、saveExpense、removeExpense、
                               addShoppingItem、toggleShoppingItem、removeShoppingItem、
                               saveItineraryItem、removeItineraryItem、moveItem、
                               成員管理與密碼相關函式等，
                 請直接沿用你上一版的實作，不再修改 === */

            // 只保留必要的 computed 與 helpers（名稱不變，對應原本程式）
            const currentItinerary = computed(() =>
                (itineraryData.value[selectedDateIndex.value] || [])
                    .sort((a, b) => (a.order || 999) - (b.order || 999))
            );

            // 其餘函式與回傳物件，也請照你上一版完整程式貼回來
            // 這裡只示意保留名稱：
            const toggleSection = (key) => { collapsedSections.value[key] = !collapsedSections.value[key]; };

            // 假設你原本已經有以下函式：fetchExchangeRate / fetchWeather / handleAddClick /
            // addMember / toggleMemberActive / removeMember / updateTWD / updateTHB /
            // toggleMemberDetails / getMemberPaidExpenses / startEditExpense / saveExpense /
            // removeExpense / addShoppingItem / toggleShoppingItem / removeShoppingItem /
            // saveItineraryItem / removeItineraryItem / editItem / getCategoryIcon /
            // getTransportIcon / getCategoryColor / getWeatherIcon / getWeatherDescription /
            // moveItem / confirmRolePassword / cancelRolePassword / updateMemberRole /
            // closeMemberModal / attemptLogin / switchUser / fetchExchangeRate / fetchWeather 等

            // === 這裡請把你上一版 setup() 裡的所有函式原封不動貼回，
            //    只要記得 INITIAL_ITINERARY / hotels 已改成上面版本即可 ===

            return {
                // state
                currentTab,
                selectedDateIndex,
                showShoppingModal,
                showExpenseModal,
                showItineraryModal,
                showMemberModal,
                isEditMode,
                editingExpenseId,
                expandedMember,
                dates,
                weatherData,
                itineraryData,
                currentItinerary,
                hotels,
                expenses,
                members,
                newShoppingItem,
                newExpense,
                newItinerary,
                newMemberName,
                allShoppingList,
                hasSelectedUser,
                currentUser,
                pendingUser,
                membersLoaded,
                showRolePasswordModal,
                rolePasswordInput,
                passwordMode,
                targetLoginMember,
                collapsedSections,
                showToast,
                toastMessage,
                inputTHB,
                inputTWD,
                EXCHANGE_RATE,
                TRIP_YEAR,
                isRatesLoading,
                recentlyMovedId,
                editInput,
                tempMemberName,
                editingMemberId,
                // helpers / computed（請用你原本那版的）
                formatNumber,
                toggleSection,
                // 其餘函式全部照你上一版 return 出去即可...
            };
        }
    });

    app.mount('#app');
</script>
</body>
</html>
